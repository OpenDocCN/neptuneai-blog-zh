<html>
<head>
<title>Feature Stores: Components of a Data Science Factory [Guide] </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>功能存储:数据科学工厂的组件[指南]</h1>
<blockquote>原文：<a href="https://web.archive.org/web/https://neptune.ai/blog/feature-stores-components-of-a-data-science-factory-guide#0001-01-01">https://web.archive.org/web/https://neptune.ai/blog/feature-stores-components-of-a-data-science-factory-guide#0001-01-01</a></blockquote><div><div class="l-content content-wrapper js-content">
            
<p>低效而昂贵的<a href="https://web.archive.org/web/20221206074029/https://towardsdatascience.com/feature-engineering-for-machine-learning-3a5e293a5114" target="_blank" rel="noreferrer noopener nofollow">特性工程</a>实践经常困扰着处理大量数据的公司。这使得他们无法组织复杂的机器学习操作。为ML目的获取数据花费了大量时间，但是不清楚模型的摄取和服务之间是否有任何不一致。</p>



<p>由于这种缓慢的过程和无法再现的结果，项目利益相关者可能会对积极的ML结果失去信任。怎么才能避免这种情况呢？</p>



<p>功能商店是答案的一部分。这是数据科学基础设施的重要组成部分，旨在为最终用户建立稳定的渠道。</p>



<h2 id="h-what-is-a-feature-store">什么是功能商店？</h2>







<p>要素存储是一种接收大量数据、计算要素并存储它们的服务。有了功能商店，<a href="https://web.archive.org/web/20221206074029/https://valohai.com/machine-learning-pipeline/" target="_blank" rel="noreferrer noopener nofollow">机器学习管道</a>和在线应用程序可以轻松访问数据。</p>



<p>作为双数据库实施，要素存储旨在提供实时数据和批处理数据:</p>



<ul><li>在线要素商店以低延迟为在线应用程序提供数据。例子有MySQL Cluster，Redis，Cassandra DB等。</li><li>离线特征存储是向外扩展的SQL数据库，为开发人工智能模型提供数据，并使特征治理在可解释性和透明度方面成为可能。例子包括Hive、BigQuery、Parquet。</li></ul>



<h3>功能存储与数据湖和数据仓库</h3>







<p>在抽象层次上，特征存储提供了数据湖功能的子集。特征存储专门用于存储机器学习应用的特征，而数据湖是特征之外的数据的集中存储库，也用于分析目的。另一方面，数据仓库为关系数据库提供了一个模式，业务分析师可以使用该模式通过编写SQL查询来生成报告、仪表板等。</p>



<h3>与特征工程相关的问题</h3>



<ul><li><strong> <em>特性定义的动态性:</em> </strong>一个特定的特性可能在组织内的多个团队中有不同的定义。如果没有适当的文档，维护特性背后的逻辑和它所传达的信息会变得越来越困难。特征存储通过维护与特征相关联的事实定义来帮助解决这个问题。这使得数据的最终用户更容易使用，并保持从该数据得出的结果的一致性。</li><li><strong> <em>特征冗余:</em> </strong>当数据必须以原始形式获取时，数据科学家花费大量时间重新提取可能已经被团队中的其他人或当前使用数据的管道提取的特征。由于要素存储提供了单一的事实来源，数据科学家可以在要素工程上花费更少的时间，而在实验和构建上花费更多的时间。</li><li><strong> <em>实验和生产环境之间的差距:</em> </strong>产品通常使用少量的编程语言和框架，这些语言和框架可能与用于实验机器学习模型的工具不同。这种差距会导致可能被忽略的不一致，并最终恶化客户端的模型/产品。换句话说，开发中模型的预期行为/性能在产品中部署时应该或多或少是可再现的。对于功能存储，这种转换是不必要的，因为它们保持了实验和生产之间的一致性。</li></ul>



<h3>ML管线中特征存储的优势</h3>



<p>来自特性库的输出是<strong>与实现无关的</strong>。无论我们使用哪种算法或框架，应用程序/模型都将以一致的格式获取数据。使用特征库的另一个主要好处是<strong>节省了原本要花费在计算特征上的时间</strong>。</p>



<h3>功能存储的组件</h3>



<ul><li><strong> <em>功能注册:</em> </strong>功能注册提供了一个中央界面，数据消费者(例如数据科学家)可以使用该界面来维护功能列表及其定义和元数据。这个中央存储库可以根据您的需要进行更新。</li><li><strong> <em>运营监控:</em> </strong>机器学习模型在初始阶段可能表现良好，但你仍然必须监控它们的正确性和随着时间推移的可靠结果。在机器学习模型中，自变量和因变量之间总有可能存在退化关系。这主要是由于输入数据的复杂性，因此随着时间的推移，预测变得更加不稳定和不准确。这种现象称为模型漂移，可以分为两种类型:<ul><li><em>概念漂移:</em><strong>目标</strong>变量的统计性质随时间变化。</li><li><em>数据漂移:</em><strong>预测器</strong>变量的统计特性随时间变化。</li></ul></li></ul>



<p>要素存储维护数据质量和正确性。它为内部和外部应用程序/工具提供了一个接口，以确保生产中的正确模型性能。</p>



<ul><li><strong> <em>转换:</em> </strong>在机器学习应用中，数据转换管道吸收原始数据，并将其转换为可用的特征。功能存储负责管理和编排它们。有三种主要的转换类型:<ul><li><em>流</em>为有速度的数据(例如实时日志)，</li><li><em>批次</em>为平稳数据，</li><li><em>按需</em>对于无法预先计算的数据。</li></ul></li><li><strong> <em>存储:</em> </strong>非即时需求的特性是离线的，通常存储在雪花、蜂巢、红移等仓库中。另一方面，在线功能是实时要求的，并存储在MongoDB、CassandraDB或Elasticsearch等数据库中，具有低延迟能力。</li><li><strong> <em>上菜:</em> </strong>特征提取和处理背后的逻辑是抽象的，这使得特征商店非常吸引人。当数据科学家出于实验目的访问数据快照(时间点)时，功能存储确保这些功能不断实时更新，并随时可供需要它们的应用程序使用。</li></ul>



<h2 id="h-feature-stores-and-mlops">功能存储和MLOps</h2>



<h3>什么是MLOps？</h3>



<p>MLOps是关于将DevOps原则应用于构建、测试和部署机器学习管道。通过MLOps实践，团队可以更频繁地部署更好的模型。MLOps面临的挑战包括:</p>



<ul><li>数据版本化，</li><li>管理专用硬件(GPU等。),</li><li>管理模型的数据治理和合规性。</li></ul>







<h3>MLOps与DevOps</h3>







<p>传统上，开发人员使用Git对代码进行版本控制，这是自动化和持续集成(CI)所必需的。这使得自动再现环境变得容易。</p>



<p>每次提交Git都会触发包的自动创建，这些包可以使用版本控制中的信息进行部署。Jenkins与版本控制软件一起用于构建、测试和部署代码，因此它以一种受控和可预测的方式运行。Jenkins涉及的步骤有:</p>



<ol><li>虚拟机(VMs容器的供应。</li><li>在这些机器上读取代码。</li><li>编译代码。</li><li>运行测试。</li><li>打包二进制文件。</li><li>部署二进制文件。</li></ol>







<p>MLOps最重要的部分是版本化数据。你不能用Git做到这一点，因为它不能扩展到大量的数据。一个简单的机器学习管道包括以下内容:</p>



<ul><li>已验证的传入数据。</li><li>特征计算。</li><li>生成培训和测试数据。</li><li>模型的训练。</li><li>模型的验证。</li><li>模型部署。</li><li>在生产中监控模型。</li></ul>



<p>当您将超参数调整、模型可解释性和分布式训练添加到图片中时，这可能会变得更加复杂。</p>



<p>编排框架有助于自动工作流执行、模型再训练、组件之间的数据传递以及基于事件的工作流触发。这些框架包括:</p>



<ul><li>tensor flow Extended(TFX)–支持气流、波束、库伯流管道</li><li>hopworks–支持气流</li><li>ml flow–支持Spark</li><li>库伯流–支持库伯流管道</li></ul>



<p>TFX、MLFlow和Hopsworks支持使用Beam和Spark的分布式处理，支持在使用大量数据的集群上横向扩展执行。</p>



<h3>机器学习管道</h3>



<p><a href="https://web.archive.org/web/20221206074029/https://www.infoworld.com/article/3271126/what-is-cicd-continuous-integration-and-continuous-delivery-explained.html" target="_blank" rel="noreferrer noopener nofollow"> DevOps CI/CD </a>大多由源代码更新触发。MLOps和DataOps CI/CD管道不仅可以由源代码更新触发，还可以由数据更新和数据处理触发:</p>



<ul><li>DataOps主要自动化数据管道的测试和部署，</li><li>MLOps自动化了培训、验证和部署模型的过程。</li></ul>



<p>对于端到端的机器学习管道，你需要非常谨慎的特征工程。这会占用你大部分的带宽。功能存储有两种帮助方式:</p>



<ul><li>接收数据，验证数据，并将其转化为可消费的功能。</li><li>消耗这些数据的机器学习算法得到训练、验证并被推向生产。</li></ul>



<p>机器学习管道的问题是它们有状态的本质。一个好的数据管道应该是无状态和幂等的。换句话说，在部署一个新模型(在验证阶段)之前，我们需要大量的信息，包括它的性能如何，我们做了什么假设，模型的影响，等等。通常，开发人员最终会一遍又一遍地重新编写代码，以正确定义输入和输出。</p>



<p>Hopsworks提供了一种无干扰元数据模型，其中管道通过Hopsworks API读写HDFS并与要素存储进行交互。通过这种方式，我们可以存储元数据、工件、模型出处等，而无需像TensorFlow Extended (TFX)或MLFlow所要求的那样重新编写代码。</p>



<p>一些行业最佳实践以及帮助我们实现这些实践的相关工具如下</p>



<ul><li>单元测试和与Jenkins的持续集成。</li><li>使用TFX或Deequ进行数据验证，以便特性具有预期值。</li><li>使用Deequ测试唯一性、缺失性和独特性。</li><li>使用TFX或Deequ检查数据分布验证。</li><li>使用Deequ的特征和与目标变量之间的成对关系。</li><li>测量每个特性成本的自定义测试。</li><li>个人身份信息(PII)泄漏测试。</li></ul>







<h2 id="h-feature-store-architectures">功能存储架构</h2>



<h3>优步的米开朗基罗机器学习平台</h3>



<p>2017年，优步推出了米开朗基罗作为人工智能即服务平台，以简化人工智能的扩展。随着不断增长的客户群和大量丰富数据的涌入，优步在其多个数据中心部署了米开朗基罗来运行他们的在线应用程序。这个平台是出于一种需要而诞生的。在米开朗基罗之前，数据科学家和工程师必须创建单独的预测模型和定制系统，这在扩大规模方面是不可持续的。</p>



<p>米开朗基罗建立在优步的基础设施之上，内部构建的组件是HDFS、Spark、XGBoost或TensorFlow等成熟开源框架的自举。它为所有事务性数据提供了一个数据湖。Kafka经纪人被部署来聚合来自优步所有服务的数据，并通过Samza计算引擎与Cassandra集群进行流式传输。</p>







<p>该平台使用Hive/HDFS来存储优步的交易和日志数据。在线模型所需的特征被预先计算并存储在CassandraDB中，在预测时可以以低延迟读取这些特征。</p>



<p>为了进行特性选择、转换，并确保输入数据被检查格式是否正确以及是否遗漏，优步的开发人员构建了他们自己的领域特定语言(DSL)作为Scala的子集。有了它，最终用户可以添加他们自己的用户定义的功能。为了保证再现性，在训练和预测期间应用相同的DSL表达式。</p>



<p>米开朗基罗支持多种机器学习算法和深度学习网络的离线、大规模分布式训练，这使得它非常具有可扩展性。模型类型、超参数、数据源、DSL表达式和计算资源要求作为模型配置提及。它还提供超参数搜索。</p>



<p>已配置的训练作业在YARN或Mesos集群上运行，之后会计算性能指标并编译成报告。运行分区模型时，训练数据会根据模型配置自动分区，并在相同的模型上进行训练。需要时使用父模型。关于最终模型的信息被存储在模型库中用于部署，并且报告被保存用于将来的分析。</p>



<p>培训工作可以通过米开朗基罗的UI、API，甚至通过Jupyter笔记本来管理。</p>



<p>训练完成后，包含以下信息的版本化对象将存储在CassandraDB中:</p>



<ol><li>模型的作者，</li><li>培训工作的开始和结束时间，</li><li>车型配置，</li><li>参考培训和测试数据，</li><li>特征级统计，</li><li>模拟性能指标，</li><li>模型的学习参数，</li><li>汇总统计数据。</li></ol>



<h3>谷歌的盛宴:开源功能商店</h3>







<p>Feast是一个用于机器学习的开源功能库，旨在简化创建、管理、共享和提供功能的过程。2019年，Gojek与谷歌云合作推出。</p>



<p>它使用BigQuery + GCS + S3实现离线特性，使用BigTable + Redis和Apache Beam实现在线特性。</p>



<p>组件:</p>



<ol><li><em>盛宴核心:</em>这是所有特性及其各自定义共存的地方。</li><li><em> Feast Job Service: </em>该组件管理将数据从数据源加载到存储中的数据处理作业，以及导出用于训练的数据的作业。</li><li><em>盛宴在线服务:</em>在线功能要求对它们的低延迟访问，这由该组件实现。</li><li><em>盛宴Python SDK: </em>这是用来管理特征定义，启动作业，检索训练数据集和在线特征。</li><li><em>在线商店:</em>它存储每个实体的最新功能。它可以由流源的批处理摄取或流摄取作业填充。</li><li><em>离线存储:</em>存储用于训练AI模型的批量数据。</li></ol>



<p>它是如何工作的？</p>



<ol><li>日志流数据是从应用程序获取的。</li><li>Kafka和Spark等流处理系统用于将这些数据转换为流特征。</li><li>然后，原始要素和流要素都被记录到数据湖中。</li><li>批处理存储中的ETL/ELT转换数据。</li><li>然后在特征核心上建立特征及其定义。</li><li>Feast Job服务轮询新的和更新的功能。</li><li>批处理摄取作业是短暂的，它们将数据提取到离线和在线存储中。</li><li>流接收作业是长期存在的，它们从流源获取并提供给在线应用程序。</li><li>启动机器学习管道，使用数据，所有这些都由SDK控制。</li><li>根据模型配置，feast提供时间点培训数据和功能。</li><li>然后，服务经训练的模型，并且后端请求来自模型服务系统的预测。</li><li>模型服务系统从盛宴在线服务请求在线特征。</li><li>模型服务系统对在线特征进行预测并返回结果。</li></ol>



<h3>霍普斯沃克的特色商店</h3>







<p>数据工程师主要负责添加/更新功能，这些功能可以使用笔记本、Python、Java或Scala编写的程序，甚至是Hopsworks的UI，通过SQL查询甚至复杂的图形嵌入来计算。程序以熊猫或火花数据帧的形式接收数据。</p>







<p>在摄取之前，使用数据验证API对要素数据进行验证。Hopsworks提供了一个UI平台，用于建立数据验证规则，通过这些规则还可以查看特性统计数据。Hopsworks还支持创建多个特性存储，因为一个特性存储不一定能被企业的所有部分访问。</p>



<p>数据科学家使用特征存储将数据分为训练集和测试集，以构建机器学习模型。在线应用程序使用它来创建一个特征向量，稍后用于推理。除此之外，用户还可以查询时间点数据。</p>







<p>特征是可测量的属性，其中每个特征属于具有用于计算的相关键的特征组。数据科学家可以通过提供/选择一组特征、特征输出的目标文件格式(CSV、TFRecords、Numpy等)来生成训练和测试数据。)，以及目标存储系统(GCS、AWS S3等。).</p>



<p>有两种方法可以计算特征组:</p>



<ul><li>按需:有对外部数据库的内置支持，允许您在外部数据源上定义特性。</li><li>缓存:Hopsworks功能存储可以扩展到1pb的功能数据。</li></ul>



<p>Hopsworks提供了很棒的关于如何使用他们的API和开始使用其特性库的文档。</p>



<h3>泰克顿的特征商店</h3>







<p>虽然大多数组织已经开始构建供内部使用的功能商店，但Tecton一直在构建他们的平台，以服务的形式提供给各种企业。他们的创始成员最初在优步，在那里他们建造了米开朗基罗。受优步产品的启发，泰克顿也建立并开始提供服务。他们还为谷歌的开源功能商店Feast做出了贡献。</p>



<h2 id="h-summary">摘要</h2>



<ul><li>特征存储加快并稳定了提取、转换数据、工程特征并存储它们的过程，以便于离线和在线访问。</li><li>功能商店如果不是无处不在的话，应该是每个组织的下一个必须采取的步骤，这些组织旨在建立最好的人工智能产品，而不必在运营目的上损失带宽。</li><li>传统的CI/CD流水线不适合处理数据和机器学习模型，这就引入了MLOps和DataOps的需求。</li><li>特色商店的一些例子是优步的米开朗基罗，谷歌的盛宴，霍普斯沃斯的特色商店和泰克顿的特色商店。</li></ul>



<h3>参考资料:</h3>




        </div>
        
    </div>    
</body>
</html>