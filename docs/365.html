<html>
<head>
<title>How to Track Machine Learning Model Metrics in Your Projects </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在您的项目中跟踪机器学习模型指标</h1>
<blockquote>原文：<a href="https://web.archive.org/web/https://neptune.ai/blog/how-to-track-machine-learning-model-metrics#0001-01-01">https://web.archive.org/web/https://neptune.ai/blog/how-to-track-machine-learning-model-metrics#0001-01-01</a></blockquote><div><div class="l-content content-wrapper js-content">
            
<p>跟踪机器学习模型的评估指标至关重要，以便:</p>



<ul><li>了解您的模型做得如何</li><li>能够将它与以前的基线和想法进行比较</li><li>了解你离项目目标有多远</li></ul>



<p>“如果你不衡量它，你就不能改进它。”</p>



<p>但是你应该跟踪什么呢？</p>



<p>我从来没有发现自己在这样的情况下，我认为我已经为我的机器学习实验记录了太多的指标。</p>



<p>此外，在现实世界的项目中，您所关心的指标可能会由于新的发现或不断变化的规范而改变，因此记录更多的指标实际上可以在将来为您节省一些时间和麻烦。</p>



<p>不管怎样，我的建议是:</p>



<p>“记录比你认为需要的更多的指标。”</p>



<p>好吧，但是你具体是怎么做的呢？</p>



<h2 id="h-tracking-metrics-that-are-a-single-number">跟踪单一数字的指标</h2>



<p>在许多情况下，您可以为机器学习模型的性能分配一个数值。您可以计算保留验证集的准确度、AUC或平均精度，并将其用作模型评估指标。</p>



<p>在这种情况下，您应该跟踪每次实验运行的所有这些值。</p>


<p>借助Neptune，您可以轻松做到这一点:</p>



<pre class="hljs">neptune.log_metric(<span class="hljs-string">'train_auc'</span>, train_auc)
neptune.log_metric(<span class="hljs-string">'valid_auc'</span>, train_auc)
neptune.log_metric(<span class="hljs-string">'valid_f1'</span>, train_auc)
neptune.log_metric(<span class="hljs-string">'valid_accuracy'</span>, train_auc)
</pre>







<section id="note-block_6004a7e9c59a1" class="block-note c-box c-box--default c-box--dark c-box--no-hover c-box--standard ">

    

    <div class="block-note__content">
                    <div class="c-item c-item--wysiwyg_editor">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <p>跟踪训练数据集和验证数据集的度量可以帮助您评估模型在生产中表现不佳的风险。差距越小，风险越低。Jean-Fran ois Puget的《kaggle days》是一个很好的资源。</p>
                                    </div>

            </div>
            </div>


</section>



<p id="separator-block_6004a804c59a3" class="block-separator block-separator--5"> </p>



<p>也就是说，有时候，一个单一的值不足以告诉你你的模型是否运行良好。</p>



<p>这就是性能图表发挥作用的地方。</p>



<h2 id="h-tracking-metrics-that-are-performance-charts">跟踪作为性能图表的指标</h2>



<p>要了解您的模型是否有所改进，您可能需要查看图表、混淆矩阵或预测分布。</p>



<p>在我看来，这些仍然是指标，因为它们帮助你衡量你的机器学习模型的性能。</p>



<p>对于Neptune测井，这些图表是微不足道的:</p>



<pre class="hljs">neptune.log_image(<span class="hljs-string">'diagnostics'</span>, <span class="hljs-string">'confusion_matrix.png'</span>)
neptune.log_image(<span class="hljs-string">'diagnostics'</span>, <span class="hljs-string">'roc_auc.png'</span>)
neptune.log_image(<span class="hljs-string">'diagnostics'</span>, <span class="hljs-string">'prediction_dist.png'</span>)
</pre>







<section id="note-block_6004a82bc59a4" class="block-note c-box c-box--default c-box--dark c-box--no-hover c-box--standard ">

    

    <div class="block-note__content">
                    <div class="c-item c-item--text">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <p>如果您想要使用二进制分类指标，您可以记录:</p>
                                    </div>

            </div>
                    <div class="c-item c-item--wysiwyg_editor">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <ul id="block-2bf4885d-2f8e-4c10-86a0-7dabbb6c85db" class="block-editor-rich-text__editable block-editor-block-list__block wp-block is-selected rich-text" tabindex="0" role="group" contenteditable="true" spellcheck="false" aria-multiline="true" aria-label="Block: List" data-block="2bf4885d-2f8e-4c10-86a0-7dabbb6c85db" data-type="core/list" data-title="List">
 t
<li>所有主要指标，如f1、f2、brier_loss、准确性等</li>
<p>t</p>
<li>所有主要的性能图表，如混淆矩阵、ROC曲线、精确召回曲线</li>
</ul>
                                    </div>

            </div>
                    
                    <div class="c-item c-item--html_code">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <pre class="hljs"><span class="hljs-keyword">import</span> neptunecontrib.monitoring.metrics <span class="hljs-keyword">as</span> npt_metrics//r//n//r//nnpt_metrics.log_binary_classification_metrics(y_test, y_test_pred)
</pre>                                    </div>

            </div>
            </div>


</section>



<p id="separator-block_6004a86ac59a9" class="block-separator block-separator--5"> </p>



<h2 id="h-tracking-iteration-level-metrics-learning-curves">跟踪迭代级别的度量(学习曲线)</h2>







<p>大多数机器学习模型迭代收敛。深度学习模型、梯度提升树和许多其他模型都是如此。</p>



<p>您可能希望在每次迭代之后跟踪训练集和验证集的评估度量，以查看您的模型是否监控过度拟合。</p>



<p>监控这些学习曲线很容易实现，但却是重要的习惯。</p>



<p>对于简单的基于迭代的训练，它可能是这样的:</p>



<pre class="hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(iterations):
   
   train_loss = loss(y_pred, y)
   neptune.log_metric(<span class="hljs-string">'train_loss'</span>, train_loss)</pre>



<p>在大多数深度学习框架中使用的回调系统的情况下:</p>



<pre class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NeptuneLoggerCallback</span><span class="hljs-params">(Callback)</span>:</span>
    ...
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_batch_end</span><span class="hljs-params">(self, batch, logs={})</span>:</span>
        <span class="hljs-keyword">for</span> log_name, log_value <span class="hljs-keyword">in</span> logs.items():
            neptune.log_metric(f<span class="hljs-string">'batch_{log_name}'</span>, log_value)</pre>







<section id="note-block_6004a895c59aa" class="block-note c-box c-box--default c-box--dark c-box--no-hover c-box--standard ">

    

    <div class="block-note__content">
                    <div class="c-item c-item--wysiwyg_editor">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <p>Neptune集成了大多数主要的机器学习框架，您可以毫不费力地跟踪这些指标。在此检查<a href="https://web.archive.org/web/20221206012745/https://docs.neptune.ai/" target="_blank" rel="noreferrer noopener">可用的集成。</a></p>
                                    </div>

            </div>
            </div>


</section>



<p id="separator-block_6004a8aac59ac" class="block-separator block-separator--5"> </p>



<h2 id="h-tracking-predictions-after-every-epoch">在每个时期后跟踪预测</h2>



<p>有时，您可能希望在每个时期或迭代后查看一下模型预测。</p>



<p>这在训练需要大量时间收敛的图像模型时尤其有价值。</p>



<p>例如，在图像分割的情况下，您可能希望在每个时期后绘制预测遮罩、真实遮罩和原始图像。</p>



<p>在Neptune中你可以使用<code>.log_image</code>方法来做到这一点:</p>



<pre class="hljs"><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> epochs:
     …
     mask_preds = get_preds(model, images)
     overlayed_preds = overlay( images, masks_true, masks_pred)
     neptune.log_image(<span class="hljs-string">'network_predictions'</span>, overlayed_preds)</pre>







<h2 id="h-tracking-metrics-after-the-training-is-done">培训完成后跟踪指标</h2>



<p>在某些应用程序中，您无法跟踪培训脚本中所有重要的指标。</p>



<p>此外，在现实生活中的机器学习项目中，项目的范围以及您关心的度量标准可能会随着时间的推移而变化。</p>



<p>在这些情况下，您将需要更新实验指标，或者在您的培训工作已经完成时添加新的性能图表。</p>



<p>幸运的是，用海王星更新实验很容易:</p>



<pre class="hljs">exp = project.get_experiments(id=<span class="hljs-string">'PROJ-421'</span>)[<span class="hljs-number">0</span>]

exp.log_metric(<span class="hljs-string">'test_auc'</span>; <span class="hljs-number">0.62</span>)
exp.log_image(<span class="hljs-string">'test_performance_charts'</span>, <span class="hljs-string">'roc_curve_test.png'</span>)</pre>



<section id="note-block_6004a8b9c59ad" class="block-note c-box c-box--default c-box--dark c-box--no-hover c-box--standard ">

    

    <div class="block-note__content">
                    <div class="c-item c-item--text">

                <img decoding="async" loading="lazy" alt="" class="c-item__arrow lazyload" src="../Images/c3f798d0d0722b36a787440f47f3a16c.png" data-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg" data-original-src="https://web.archive.org/web/20221206012745/https://neptune.ai/wp-content/themes/neptune/img/blocks/note/list-arrow.svg"/>

                <div class="c-item__content">

                                            <p>请记住，为一个实验或模型引入新的指标意味着您可能需要重新计算和更新以前的实验。通常情况下，一个模型在一个度量上可能更好，而在另一个度量上可能更差。</p>
                                    </div>

            </div>
            </div>


</section>



<p id="separator-block_6004a8ccc59af" class="block-separator block-separator--5">最后的想法</p>



<h2 id="h-final-thoughts">在本文中，我们了解到:</h2>



<p>你应该记录你的机器学习指标</p>



<ul><li>如何跟踪单值指标并查看哪些模型表现更好</li><li>如何跟踪学习曲线以实时监控模型训练</li><li>如何跟踪性能图表以了解更多信息</li><li>如何在每个时期后记录图像预测，</li><li>如果在培训结束后计算评估指标，如何更新实验指标</li><li>快乐训练！</li></ul>



<p>Happy training!</p>
        </div>
        
    </div>    
</body>
</html>