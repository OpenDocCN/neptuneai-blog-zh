<html>
<head>
<title>Streamlit Guide: How to Build Machine Learning Applications </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Streamlit指南:如何构建机器学习应用程序</h1>
<blockquote>原文：<a href="https://web.archive.org/web/https://neptune.ai/blog/streamlit-guide-machine-learning#0001-01-01">https://web.archive.org/web/https://neptune.ai/blog/streamlit-guide-machine-learning#0001-01-01</a></blockquote><div><div class="l-content content-wrapper js-content">
            
<p>构建机器学习应用程序变得越来越容易。有了<a href="https://web.archive.org/web/20221207112623/https://www.streamlit.io/" target="_blank" rel="noreferrer noopener nofollow"> Streamlit </a>，你可以快速轻松地开发机器学习应用。您还可以使用Streamlit共享平台，只需点击几下鼠标即可部署您的应用。</p>



<p>使用Streamlit开始开发并不需要很长时间，因为您甚至不需要任何前端web开发经验。有了Streamlit，你可以用Python编写任何东西。Streamlit还与您可能知道的数据科学库兼容。</p>



<p>在本文中，我们将了解如何利用Streamlit开发您的机器学习应用程序。</p>



<h2 id="h-streamlit-installation">细流安装</h2>



<p>准备好Python环境后，Streamlit的安装非常简单:</p>



<pre class="hljs">$ pip install streamlit</pre>



<p>如果您只是尝试一下，您可以运行hello world示例:</p>



<pre class="hljs">$ streamlit hello</pre>



<p>在官方回购中还有更大的例子。使用Streamlit时，您通常会将其作为“st”导入。</p>



<h3>如何运行细流应用程序</h3>



<p>假设您已经在一个名为“app.py”的文件中编写了Streamlit代码，您可以使用以下命令运行该应用程序:</p>



<pre class="hljs">$ streamlit run app.py</pre>



<p>“运行app.py”将开始在您的本地计算机上运行应用程序，并提供一个链接，您可以使用该链接在网络上访问应用程序。</p>







<p>Streamlit通过提供小部件使开发web应用程序变得容易。让我们来看看其中的一些。</p>



<h3>在细流中显示文本</h3>



<p>Streamlit有几个用于显示文本的小部件，例如:</p>



<ul><li>` st.text '显示固定宽度和预格式化的文本</li><li>` st.markdown '显示降价文本</li><li>` st.latex '显示latex格式的数学表达式</li><li>“st.write”根据给它的输入有不同的行为。例如:<ul><li>当您将数据框传递给它时，它会将数据框打印为表格</li><li>当向函数传递函数时，显示有关函数的信息</li><li>当一个Keras模型传递给它时，显示该模型</li><li>` st.title `以标题格式显示文本</li><li>` st.header `以页眉格式显示文本</li><li>` st.code '显示代码</li></ul></li></ul>



<p>这里有一个例子说明了它们的作用:</p>



<pre class="hljs"><span class="hljs-keyword">import</span> streamlit <span class="hljs-keyword">as</span> st
st.code(<span class="hljs-string">"st.text()"</span>, language=<span class="hljs-string">'python'</span>)
st.text(<span class="hljs-string">'Neptune AI Blog'</span>)
st.code(<span class="hljs-string">"st.markdown()"</span>, language=<span class="hljs-string">'python'</span>)
st.markdown(<span class="hljs-string">'# This is Heading 1 in Markdown'</span>)
st.code(<span class="hljs-string">"st.title()"</span>, language=<span class="hljs-string">'python'</span>)
st.title(<span class="hljs-string">'This is a title'</span>)
st.code(<span class="hljs-string">"st.header()"</span>, language=<span class="hljs-string">'python'</span>)
st.header(<span class="hljs-string">'Header'</span>)
st.code(<span class="hljs-string">"st.subheader()"</span>, language=<span class="hljs-string">'python'</span>)
st.subheader(<span class="hljs-string">'Sub Header'</span>)
st.code(<span class="hljs-string">"st.latex()"</span>, language=<span class="hljs-string">'python'</span>)
st.latex(<span class="hljs-string">r'''
<span class="hljs-meta">... </span>    a + ar + a r^2 + a r^3 + cdots + a r^{n-1} =
<span class="hljs-meta">... </span>    sum_{k=0}^{n-1} ar^k =
<span class="hljs-meta">... </span>    a left(frac{1-r^{n}}{1-r}right)
<span class="hljs-meta">... </span>    '''</span>)
st.code(<span class="hljs-string">"st.write()"</span>, language=<span class="hljs-string">'python'</span>)
st.write(<span class="hljs-string">'Can display many things'</span>)</pre>



<figure class="wp-block-image size-large is-resized"><img decoding="async" src="../Images/1f370ccd3fe1d8f5d9a1683c5b11cca5.png" alt="Streamlit widgets" class="wp-image-41125" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221207112623im_/https://i0.wp.com/neptune.ai/wp-content/uploads/2022/10/Streamlit-widgets.png?resize=733%2C533&amp;ssl=1"/></figure>



<h3>在细流中显示数据</h3>



<p>Streamlit也可以显示数据。数据可以显示为JSON、表或数据框。</p>



<pre class="hljs">df = pd.read_csv(<span class="hljs-string">"data.csv"</span>)
st.dataframe(df)
st.table(df)
st.json(json_data) </pre>



<h3>在细流中显示媒体</h3>



<p>Streamlit还允许您向应用程序添加媒体。您可以添加音频、视频或图像。为此，您可以使用“音频”、“视频”和“图像”小部件。</p>



<pre class="hljs"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
icon = Image.open(<span class="hljs-string">"icon.png"</span>)
image = Image.open(<span class="hljs-string">"logo.png"</span>)
st.image(image)

video_file = open(<span class="hljs-string">"video.mp4"</span>, <span class="hljs-string">"rb"</span>)
video_bytes = video_file.read()
st.video(video_bytes)

audio_file = open(<span class="hljs-string">"video.wav"</span>, <span class="hljs-string">"rb"</span>)
audio_bytes = audio_file.read()
st.audio(audio_bytes)</pre>



<h3>在Streamlit中显示代码</h3>



<p>使用' with st.echo()'命令显示其后的代码。例如，此代码将显示代码，然后显示数据框:</p>



<pre class="hljs"><span class="hljs-keyword">with</span> st.echo():
    df = pd.read_csv(<span class="hljs-string">"data.csv"</span>)
    st.dataframe(df)
</pre>







<h3>在Streamlit中显示进度和状态</h3>



<p>构建应用程序时，显示用户进度或某些状态总是一个好习惯。例如，加载大型数据集时，可以显示进度条。您可以在Streamlit中使用的一些其他状态和进度小部件包括:</p>



<ul><li>` st.spinner()`在执行代码块时显示临时消息</li><li>` st.balloons()`显示庆祝气球</li><li>` st.error()`显示错误消息</li><li>` st.warning '显示警告信息</li><li>` st.info '显示信息性消息</li><li>` st.success '显示成功消息</li><li>` st.exception '在应用程序中传达一个异常</li></ul>



<pre class="hljs"><span class="hljs-keyword">import</span> time
my_bar = st.progress(<span class="hljs-number">0</span>)
<span class="hljs-keyword">for</span> percent_complete <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>):
    time.sleep(<span class="hljs-number">0.1</span>)
    my_bar.progress(percent_complete + <span class="hljs-number">1</span>)
st.spinner()
<span class="hljs-keyword">with</span> st.spinner(text=<span class="hljs-string">'In progress'</span>):
    time.sleep(<span class="hljs-number">5</span>)
    st.success(<span class="hljs-string">'Done'</span>)
st.balloons()
st.error(<span class="hljs-string">'Error message'</span>)
st.warning(<span class="hljs-string">'Warning message'</span>)
st.info(<span class="hljs-string">'Info message'</span>)
st.success(<span class="hljs-string">'Success message'</span>)
e = RuntimeError(<span class="hljs-string">'This is an exception of type RuntimeError'</span>)
st.exception(e)</pre>



<h3>在细流中显示图表</h3>



<p>Streamlit支持以下库中的可视化:</p>







<p>Streamlit还提供了几个函数来执行基本的可视化:</p>



<ul><li>折线图的“st.line_chart(data)”</li><li>面积图的“st.area_chart(data)”</li><li>` st.bar_chart(data)`显示条形图</li><li>` st.map(data)`用于在地图上绘制数据</li></ul>



<h3>细流中的交互式小部件</h3>



<p>Streamlit还有一些小部件，让用户可以与您的应用程序进行交互，例如:</p>



<ul><li>您可以使用选择框让用户在几个选项之间进行选择(比如，允许用户根据某个类别过滤数据)</li><li>多选小部件类似于选择框，但允许多重选择</li><li>文本区域和文本输入小部件可以用来收集用户输入</li><li>日期和时间输入可用于收集时间和日期输入</li><li>您还可以让用户使用文件上传器小部件上传文件(当您已经构建了图像分类器或对象检测模型，并且希望用户上传图像并查看结果时，这可能会很方便)</li></ul>



<pre class="hljs">st.button(<span class="hljs-string">'Click here'</span>)
st.checkbox(<span class="hljs-string">'Check'</span>)
st.radio(<span class="hljs-string">'Radio'</span>, [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
st.selectbox(<span class="hljs-string">'Select'</span>, [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
st.multiselect(<span class="hljs-string">'Multiple selection'</span>, [<span class="hljs-number">21</span>,<span class="hljs-number">85</span>,<span class="hljs-number">53</span>])
st.slider(<span class="hljs-string">'Slide'</span>, min_value=<span class="hljs-number">10</span>, max_value=<span class="hljs-number">20</span>)
st.select_slider(<span class="hljs-string">'Slide to select'</span>, options=[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
st.text_input(<span class="hljs-string">'Enter some text'</span>)
st.number_input(<span class="hljs-string">'Enter a number'</span>)
st.text_area(<span class="hljs-string">'Text area'</span>)
st.date_input(<span class="hljs-string">'Date input'</span>)
st.time_input(<span class="hljs-string">'Time input'</span>)
st.file_uploader(<span class="hljs-string">'File uploader'</span>)
st.color_picker(<span class="hljs-string">'Color Picker'</span>)</pre>



<h3>细流中的缓存</h3>



<p>在任何应用程序中，缓存服务器通过确保数据和某些功能在用户需要时可用来改善用户体验。例如，您可以让应用程序缓存数据，以减少获取数据所花费的时间。您还可以缓存返回数据的函数的结果。</p>



<pre class="hljs"><span class="hljs-meta">@st.cache</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch_data</span><span class="hljs-params">()</span>:</span>
    df = pd.read_csv(<span class="hljs-string">"data.csv"</span>)
    <span class="hljs-keyword">return</span> df

data = fetch_data()</pre>



<p>第一次使用“@st.cache”运行函数时，结果将存储在本地缓存中。如果下次调用函数时，代码、输入参数和函数名称没有改变，Streamlit将跳过执行并读取缓存的结果。</p>



<h2 id="h-personalizing-streamlit-apps">个性化细流应用</h2>



<p>在Streamlit中，您可以个性化:</p>



<ul><li>页面的标题</li><li>页面的图标</li><li>页面布局(居中或宽)</li><li>是否最初加载侧边栏</li></ul>



<pre class="hljs">icon = Image.open(<span class="hljs-string">"icon.png"</span>)
st.set_page_config(
    page_title=<span class="hljs-string">"Data Application"</span>,
    page_icon=icon,
    layout=<span class="hljs-string">"centered"</span>,
    initial_sidebar_state=<span class="hljs-string">"auto"</span>,
)</pre>



<h2 id="h-streamlit-configurations">细流配置</h2>



<p>Streamlit在默认配置下运行良好。您可以使用下面的命令检查您当前的配置。</p>



<pre class="hljs">$ streamlit config show</pre>



<p>但是，有时您会遇到迫使您添加或更改默认设置的情况。有四种不同的方法。</p>



<h3>在全局文件中</h3>



<p>在这种情况下` ~/。编辑了适用于macOS/Linux的streamlit/config.toml。在Windows中，将为“%userprofile%/”。例如，您可以更改运行streamlit的默认端口。</p>



<pre class="hljs">

port = <span class="hljs-number">8502</span></pre>



<h3>在每个项目的配置文件中</h3>



<p>在这种情况下，配置被传递到`＄CWD/streamlit/config.toml `文件，其中CWD是运行streamlit的文件夹。</p>



<h3>通过环境变量</h3>



<p>这里,“STREAMLIT_*”环境变量通过终端传递:</p>



<pre class="hljs">$ export STREAMLIT_SERVER_PORT=<span class="hljs-number">8502</span></pre>



<h3>作为命令行上的标志</h3>



<p>您也可以在执行Streamlit“run”命令时使用标志来设置配置。</p>



<pre class="hljs">$ streamlit run app.py --server.port <span class="hljs-number">8502</span></pre>



<h2 id="h-integrating-visualization-libraries-to-streamlit">将可视化库集成到细流</h2>



<p>让我们看看如何将Streamlit与常见的可视化库结合使用。</p>



<h3>在Streamlit中使用Matplotlib和Seaborn</h3>



<p>在Streamlit中使用Matplotlib和Seaborn时，您唯一要做的事情就是定义一个图形并将其传递给' st.pyplot'。</p>



<pre class="hljs">fig = plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))
st.pyplot(fig)</pre>



<h3>在细流中进行plotly集成</h3>



<p>使用Plotly时，您将定义一个图形，并将其传递给' plotly _ chart` Streamlit函数。</p>



<pre class="hljs">fig = px.scatter(
      ….
    )
    st.plotly_chart(fig)</pre>



<h3>在Streamlit中使用Vega-Lite</h3>



<p>如果您正在使用Vega-Lite，您将使用“vega_lite_chart”函数，如下所示:</p>



<pre class="hljs">st.vega_lite_chart(
        df,
        {
            <span class="hljs-string">"mark"</span>: {...},
            <span class="hljs-string">"width"</span>: width,
            <span class="hljs-string">"height"</span>: height,
            <span class="hljs-string">"encoding"</span>: {
                <span class="hljs-string">"x"</span>: {...},
                <span class="hljs-string">"y"</span>: {...},
                <span class="hljs-string">"size"</span>: {...},
                <span class="hljs-string">"color"</span>: {...},
            },
        },
    )</pre>



<h3>在细流中使用altair</h3>



<p>使用Altair时，您将使用` altair.Chart()'定义一个图表，然后使用` st.altair_chart()'显示它:</p>



<pre class="hljs">chart = (
            alt.Chart(data)
            .mark_bar()
            .encode(x=alt.X(...)
            .properties(...)
            .interactive()
        )
st.altair_chart(chart)</pre>



<h3>用细流可视化地图</h3>



<p>您可以使用' st.map()'在地图上绘制数据。它是“st.pydeck_chart”的包装器，在地图上创建散点图:</p>



<pre class="hljs">map_data = df[[<span class="hljs-string">"lat"</span>, <span class="hljs-string">"lon"</span>]]
st.map(map_data)</pre>



<p>使用此功能时，您必须使用一个<a href="https://web.archive.org/web/20221207112623/https://www.mapbox.com/" target="_blank" rel="noreferrer noopener nofollow">个人地图框令牌</a>。您可以在` ~/中设置它。streamlit/config.toml `:</p>



<pre class="hljs">[mapbox]
token = <span class="hljs-string">"YOUR_MAPBOX_TOKEN"</span></pre>







<h2 id="h-streamlit-components">细流组件</h2>



<p>您可能会发现Streamlit并不正式支持您需要的某种功能。这就是<a href="https://web.archive.org/web/20221207112623/https://www.streamlit.io/components" target="_blank" rel="noreferrer noopener nofollow"> Streamlit组件</a>派上用场的地方。这些是社区在Streamlit之上构建的一组包。例如，您可以使用<a href="https://web.archive.org/web/20221207112623/https://github.com/randyzwitch/streamlit-embedcode" target="_blank" rel="noreferrer noopener nofollow"> Streamlit embed code </a>组件来嵌入来自Github Gist、CodePen snippets、Gitlab snippets等的代码片段。</p>



<pre class="hljs"><span class="hljs-keyword">from</span> streamlit_embedcode <span class="hljs-keyword">import</span> github_gist
github_gist(gist_url)</pre>



<p>Streamlit还有一个API，您可以使用它来<a href="https://web.archive.org/web/20221207112623/https://docs.streamlit.io/en/stable/streamlit_components.html" target="_blank" rel="noreferrer noopener nofollow">构建您的组件</a>。</p>



<h2 id="h-laying-out-your-streamlit-application">布局您的Streamlit应用程序</h2>



<p>Streamlit允许您使用容器和列来布局应用程序。然而，这项功能仍处于测试阶段。正如您将看到的，方法有' beta_ '前缀。一旦这些特性变得稳定，你所要做的就是去掉beta前缀。` beta_columns '并排布置容器。</p>



<p>` beta_container '插入一个可用于保存多个元素的不可见容器。您可以使用的另一个函数是“beta_expander ”,它可以生成一个可以展开和折叠的多元素容器。下面是所有这些项目的一个实例。</p>







<pre class="hljs"><span class="hljs-keyword">with</span> left_column:
    st.altair_chart(chart)
<span class="hljs-keyword">with</span> right_column:
    st.altair_chart(chart)
<span class="hljs-keyword">with</span> st.beta_container():
    st.altair_chart(chart)
<span class="hljs-keyword">with</span> st.beta_expander(<span class="hljs-string">"Some explanation"</span>):
    st.write(<span class="hljs-string">"This is an explanation of the two graphs.."</span>)</pre>



<h2 id="h-authenticating-streamlit-apps">认证Streamlit应用</h2>



<p>目前，Streamlit中还没有对身份验证的官方支持。但是，有一些变通办法。如果您熟悉Flask，您可以编写您的身份验证函数并将其编织到Streamlit中。</p>



<p>另一种方法是使用这个<a href="https://web.archive.org/web/20221207112623/https://gist.github.com/tvst/036da038ab3e999a64497f42de966a92" target="_blank" rel="noreferrer noopener nofollow">会话状态要点</a>来添加每个会话状态以简化它。您可以使用“st.empty”小部件来初始化单个元素容器。这很有用，因为一旦用户输入正确的密码，你就可以放弃它，显示你想要的功能。</p>











<pre class="hljs">PASSWORD = config(<span class="hljs-string">'PASSWORD'</span>)
session_state = SessionState.get(username=<span class="hljs-string">''</span>, password=<span class="hljs-string">''</span>)
<span class="hljs-keyword">if</span> (session_state.password == PASSWORD):
    your_function()

<span class="hljs-keyword">elif</span> ( session_state.password != PASSWORD):
    password_placeholder = st.empty()
    password = password_placeholder.text_input(<span class="hljs-string">"Enter Password:"</span>, type=<span class="hljs-string">"password"</span>)
    session_state.password = password

    <span class="hljs-keyword">if</span> (password <span class="hljs-keyword">and</span> session_state.password == PASSWORD):
        password_placeholder.empty()
        st.success(<span class="hljs-string">"Logged in successfully"</span>)
        your_function()
    <span class="hljs-keyword">elif</span>(password <span class="hljs-keyword">and</span> session_state.password != PASSWORD):
        st.error(<span class="hljs-string">"Wrong password"</span>)</pre>



<h2 id="h-uploading-and-processing-files-in-streamlit">在细流中上传和处理文件</h2>



<p>让我们看看如何在Streamlit中上传和处理文件。虽然您可以上传其他文件，如CSV文件等，但是这个示例将集中在图像数据上。</p>



<h3>使用Streamlit构建影像分类应用程序</h3>



<p>对于这个示例，让我们使用一个预先训练的TensorFlow Hub模型来构建一个应用程序，该应用程序可以根据植物的叶子图像来识别疾病的类型。这是这个应用程序的一个演示。稍后，您将致力于将其投入生产。</p>







<p>对于这个应用程序，您需要以下软件包:</p>



<ul><li>显然是“简化”</li><li>`<a href="/web/20221207112623/https://neptune.ai/blog/pil-image-tutorial-for-machine-learning" target="_blank" rel="noreferrer noopener nofollow"> pillow </a>`用于调整用户将要上传的图像的大小</li><li>用于显示图像的“matplotlib”</li><li>用于加载预训练模型的“tensorflow_hub”</li><li>用于扩展图像尺寸的“numpy”</li></ul>



<pre class="hljs"><span class="hljs-keyword">import</span> streamlit <span class="hljs-keyword">as</span> st
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> tensorflow_hub <span class="hljs-keyword">as</span> hub
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> preprocessing</pre>



<p>该应用程序将有两个主要功能:</p>



<ul><li>主要功能:让用户上传图片</li><li>预测功能:对上传的图像进行推理</li></ul>



<p>先说主要功能。如前所述，您可以使用“header”来设置应用程序标题。</p>



<p>在main函数中，您使用“st.file_uploader”让用户上传图像。您也可以在文件上传程序中指定可接受的文件类型。上传图像后，枕头上的“图像”被用来打开它。接下来，运行预测函数并显示结果。您可以在结果下方绘制图像。</p>



<pre class="hljs">st.header(<span class="hljs-string">"Predict if plant is healthy"</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    file_uploaded = st.file_uploader(<span class="hljs-string">"Choose File"</span>, type=[<span class="hljs-string">"png"</span>,<span class="hljs-string">"jpg"</span>,<span class="hljs-string">"jpeg"</span>])

    <span class="hljs-keyword">if</span> file_uploaded <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:
        image = Image.open(file_uploaded)
        fig = plt.figure()
        plt.imshow(image)
        plt.axis(<span class="hljs-string">"off"</span>)
        predictions = predict(image)
        st.write(predictions)
        st.pyplot(fig)</pre>



<p>现在来看预测函数。在这个函数中，您需要做几件事情:</p>



<ul><li>从TensorFlow Hub加载预训练模型</li><li>将用户上传的图像调整到所需的大小(此型号需要300 x 300的图像)</li><li>将图像转换为数组，并将其标准化</li><li>在图像维度中包含批量大小(这只是一个图像，因此批量大小为1)</li><li>运行预测并将它们映射到类名</li></ul>



<pre class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span><span class="hljs-params">(image)</span>:</span>
    classifier_model = <span class="hljs-string">"https://tfhub.dev/agripredict/disease-classification/1"</span>
    IMAGE_SHAPE = (<span class="hljs-number">300</span>, <span class="hljs-number">300</span>,<span class="hljs-number">3</span>)
    model = tf.keras.Sequential([
    hub.KerasLayer(classifier_model,input_shape=IMAGE_SHAPE)])
    test_image = image.resize((<span class="hljs-number">300</span>,<span class="hljs-number">300</span>))
    test_image = preprocessing.image.img_to_array(test_image)
    test_image = test_image / <span class="hljs-number">255.0</span>
    test_image = np.expand_dims(test_image, axis=<span class="hljs-number">0</span>)
    class_names = [
          <span class="hljs-string">'Tomato Healthy'</span>,
          <span class="hljs-string">'Tomato Septoria Leaf Spot'</span>,
          <span class="hljs-string">'Tomato Bacterial Spot'</span>,
          <span class="hljs-string">'Tomato Blight'</span>,
          <span class="hljs-string">'Cabbage Healthy'</span>,
          <span class="hljs-string">'Tomato Spider Mite'</span>,
          <span class="hljs-string">'Tomato Leaf Mold'</span>,
          <span class="hljs-string">'Tomato_Yellow Leaf Curl Virus'</span>,
          <span class="hljs-string">'Soy_Frogeye_Leaf_Spot'</span>,
          <span class="hljs-string">'Soy_Downy_Mildew'</span>,
          <span class="hljs-string">'Maize_Ravi_Corn_Rust'</span>,
          <span class="hljs-string">'Maize_Healthy'</span>,
          <span class="hljs-string">'Maize_Grey_Leaf_Spot'</span>,
          <span class="hljs-string">'Maize_Lethal_Necrosis'</span>,
          <span class="hljs-string">'Soy_Healthy'</span>,
          <span class="hljs-string">'Cabbage Black Rot'</span>]
    predictions = model.predict(test_image)
    scores = tf.nn.softmax(predictions[<span class="hljs-number">0</span>])
    scores = scores.numpy()
    results = {
          <span class="hljs-string">'Tomato Healthy'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato Septoria Leaf Spot'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato Bacterial Spot'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato Blight'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Cabbage Healthy'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato Spider Mite'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato Leaf Mold'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Tomato_Yellow Leaf Curl Virus'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Soy_Frogeye_Leaf_Spot'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Soy_Downy_Mildew'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Maize_Ravi_Corn_Rust'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Maize_Healthy'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Maize_Grey_Leaf_Spot'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Maize_Lethal_Necrosis'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Soy_Healthy'</span>:<span class="hljs-number">0</span>,
          <span class="hljs-string">'Cabbage Black Rot'</span>:<span class="hljs-number">0</span>
}

    result = f<span class="hljs-string">"{class_names[np.argmax(scores)]} with a { (100 * np.max(scores)).round(2) } percent confidence."</span>
    <span class="hljs-keyword">return</span> result</pre>



<p>最后一步是运行主函数。</p>



<pre class="hljs"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()</pre>



<p>点击查看完整示例<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit/blob/master/disease/app.py" target="_blank" rel="noreferrer noopener nofollow">。</a></p>



<h2 id="h-use-hugging-face-to-develop-a-natural-language-processing-application-with-streamlit">用Streamlit开发一个自然语言处理应用</h2>



<p>再来看另一个例子:用<a href="https://web.archive.org/web/20221207112623/https://github.com/huggingface/transformers/blob/master/notebooks/03-pipelines.ipynb" target="_blank" rel="noreferrer noopener nofollow">拥抱脸</a>构建自然语言处理app。这个应用程序使用“拥抱脸”的“变形金刚”包，所以不要忘记通过“pip”安装它。</p>







<p>您可以使用该软件包执行的一些功能包括:</p>



<ul><li>文本摘要</li><li>文本翻译</li><li>文本分类</li><li>问题回答</li><li>命名实体识别</li></ul>



<p>让我们转换一些句子。</p>



<p>您可以从导入本例所需的两个包开始，然后创建一个选择框，让用户选择一个任务。</p>



<pre class="hljs"><span class="hljs-keyword">import</span> streamlit <span class="hljs-keyword">as</span> st
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

option = st.selectbox(
    <span class="hljs-string">"Select Option"</span>,
    [
        <span class="hljs-string">"Classify Text"</span>,
        <span class="hljs-string">"Question Answering"</span>,
        <span class="hljs-string">"Text Generation"</span>,
        <span class="hljs-string">"Named Entity Recognition"</span>,
        <span class="hljs-string">"Summarization"</span>,
        <span class="hljs-string">"Translation"</span>,
    ],
)</pre>



<p>运行任何任务都需要在任务的同时初始化“管道”。下面是一个文本分类和问答的例子。为了可读性，其他的都被省略了。</p>



<pre class="hljs"><span class="hljs-keyword">if</span> option == <span class="hljs-string">"Classify Text"</span>:
    text = st.text_area(label=<span class="hljs-string">"Enter a text here"</span>)
    <span class="hljs-keyword">if</span> text:
        classifier = pipeline(<span class="hljs-string">"sentiment-analysis"</span>)
        answer = classifier(text)
        st.write(answer)
<span class="hljs-keyword">elif</span> option == <span class="hljs-string">"Question Answering"</span>:
    q_a = pipeline(<span class="hljs-string">"question-answering"</span>)
    context = st.text_area(label=<span class="hljs-string">"Enter the context"</span>)
    question = st.text_area(label=<span class="hljs-string">"Enter the question"</span>)
    <span class="hljs-keyword">if</span> context <span class="hljs-keyword">and</span> question:
        answer = q_a({<span class="hljs-string">"question"</span>: question, <span class="hljs-string">"context"</span>: context})
        st.write(answer)</pre>



<p>你可以在这里找到完整的<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit/blob/master/13%20Hugging%20Face/app.py" target="_blank" rel="noreferrer noopener nofollow">拥抱脸示例</a>。</p>



<h2 id="h-deploying-streamlit-applications">部署细流应用程序</h2>



<p>构建应用程序后，您希望将其托管在某个地方，以便用户可以访问它。让我们看看如何托管我们之前开发的植物病害应用程序。有几个选项可以做到这一点:</p>







<h3>细流共享</h3>



<p>Streamlit共享是将您的Streamlit应用程序投入生产的最简单快捷的方式。有一个警告——它必须在Github上公开托管。</p>



<p>如果您的应用程序是公开的，那么这是一个很好的选择。然而，目前，在您可以访问Streamlit共享平台之前，您需要<a href="https://web.archive.org/web/20221207112623/https://share.streamlit.io/" target="_blank" rel="noreferrer noopener nofollow">请求邀请</a>。</p>



<p>收到邀请后，只需点击一个按钮，即可完成部署您的Streamlit应用程序。您只需选择回购，然后单击“部署”。你需要确保你把你的应用程序和你的应用程序在requirements.txt文件中的需求一起推送到Github。</p>







<h3>Heroku</h3>



<p>要将您的Streamlit应用程序部署到Heroku，您需要三个文件:</p>



<ul><li>告知Heroku应用程序类型的Procfile(在本例中是Python)</li><li>requirement.txt包含应用程序所需的所有包</li><li>包含有关Streamlit配置信息的“setup.sh”文件</li></ul>



<p>准备就绪后，您将继续您通常的Heroku部署过程。检查该关联回购的<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit/tree/master/14%20Deploy" target="_blank" rel="noreferrer noopener nofollow">部署文件夹，查看上述文件的内容。</a></p>



<h2 id="h-streamlit-and-neptune-ai">细流和海王星ai</h2>



<p>您还可以使用Streamlit为您的Neptune实验构建自定义可视化。让我们假设您有一个<a href="/web/20221207112623/https://neptune.ai/blog/how-to-organize-your-lightgbm-ml-model-development-process-examples-of-best-practices" target="_blank" rel="noreferrer noopener"> LightGBM实验</a>，并且想要可视化运行时间与参数提升类型。当然，您可以根据需要可视化任意多的项目；这只是如何做到这一点的一个例子。</p>






<p>好的，首先，你需要从Neptune获取仪表板数据。第一步是用API键初始化Neptune:</p>



<pre class="hljs">project = neptune.init(project_qualified_name=<span class="hljs-string">'mwitiderrick/LightGBM'</span>, api_token=<span class="hljs-string">'YOUR_API_KEY'</span>)</pre>



<p>接下来，定义一个从Neptune加载数据的函数。您还可以根据实验的频率来缓存数据。在这种情况下，使用60秒，这意味着缓存将在60秒后过期。该函数返回一个数据帧，该数据帧随后存储在一个“df”变量中。</p>



<pre class="hljs"><span class="hljs-meta">@st.cache(ttl=60)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_leaderboard_data</span><span class="hljs-params">()</span>:</span>
    leaderboard = project.get_leaderboard()
    <span class="hljs-keyword">return</span> leaderboard

df = get_leaderboard_data()</pre>



<p>下一步是使用您最喜欢的可视化工具绘制数据框中的列。这里就用<a href="/web/20221207112623/https://neptune.ai/blog/plotly-python-tutorial-for-machine-learning-specialists" target="_blank" rel="noreferrer noopener nofollow"> Plotly </a>吧。</p>



<pre class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">visualize_leaderboard_data</span><span class="hljs-params">()</span>:</span>
    fig = px.pie(
        df,
        hole=<span class="hljs-number">0.2</span>,
        values=<span class="hljs-string">"running_time"</span>,
        names=<span class="hljs-string">"parameter_boosting_type"</span>,
        title=<span class="hljs-string">"Running time vs Parameter boosting type"</span>,
        color_discrete_sequence=px.colors.sequential.Blackbody,
    )
    st.plotly_chart(fig)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    visualize_leaderboard_data()</pre>



<p>点击查看完整示例<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit/blob/master/Neptune/app.py" target="_blank" rel="noreferrer noopener nofollow">。</a></p>



<h3>用细流可视化neptune项目进度</h3>



<p>有了这些背景知识，让我们看看如何使用Streamlit来可视化海王星实验的进展。这个例子将建立在前一个例子的基础上，因为这里仍然需要排行榜数据。</p>







<p>对于这个例子，你需要<a href="https://web.archive.org/web/20221207112623/https://neptune-contrib.readthedocs.io/installation.html" target="_blank" rel="noreferrer noopener">安装</a> `neptunecontrib`。</p>



<p>之后，您可以从排行榜数据框中提取进度信息。为此，您可以使用“neptunecontrib.api.utils”中的“extract_project_progress_info”函数。</p>



<pre class="hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_progress_data</span><span class="hljs-params">()</span>:</span>
    leaderboard = project.get_leaderboard()
    progress_df = extract_project_progress_info(leaderboard,
                                            metric_colname=<span class="hljs-string">'running_time'</span>,
                                            time_colname=<span class="hljs-string">'created'</span>)
    <span class="hljs-keyword">return</span> progress_df</pre>



<p>该函数需要您选择的度量列和时间戳格式的时间列。然后，它提取与分析项目进度相关的信息。</p>



<p>这是进度数据帧的视觉效果:</p>







<p>然后，可以使用“neptunecontrib.viz.projects”中的“project_progress”功能来显示进度数据框。</p>



<p>该函数创建一个交互式项目进度探索图。由于它返回一个Altair图表，您可以使用“st.altair_chart”在您的Streamlit应用程序中显示它。</p>



<pre class="hljs">progress_df = get_progress_data()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">visualize_progress</span><span class="hljs-params">()</span>:</span>
    plot = project_progress(progress_df, width=<span class="hljs-number">400</span>, heights=[<span class="hljs-number">50</span>, <span class="hljs-number">200</span>])
    st.altair_chart(plot)</pre>



<p>点击查看完整的<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit/blob/master/Visualize%20Neptune%20Project%20Progress/app.py" target="_blank" rel="noreferrer noopener nofollow">示例。</a></p>



<h2 id="h-final-thoughts">最后的想法</h2>



<p>在本文中，我们探讨了如何使用Streamlit构建应用程序，并执行了几个示例。为了可读性，完整的例子被省略了，否则这篇文章会太长。</p>



<p>但是，您可以查看本报告中所有完整的<a href="https://web.archive.org/web/20221207112623/https://github.com/mwitiderrick/Streamlit" target="_blank" rel="noreferrer noopener nofollow">示例。由于它们是Streamlit应用程序，您可以克隆它们并将其部署到Streamlit共享上进行查看。或者，您可以在本地机器上运行它们。</a></p>



<p>我等不及要看你造的东西了！</p>



<h3>其他资源:</h3>




        </div>
        
    </div>    
</body>
</html>