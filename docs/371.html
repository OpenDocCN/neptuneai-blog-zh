<html>
<head>
<title>A Quickstart Guide to Auto-Sklearn (AutoML) For Machine Learning Practitioners </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>面向机器学习从业者的自动学习快速入门指南</h1>
<blockquote>原文：<a href="https://web.archive.org/web/https://neptune.ai/blog/a-quickstart-guide-to-auto-sklearn-automl-for-machine-learning-practitioners#0001-01-01">https://web.archive.org/web/https://neptune.ai/blog/a-quickstart-guide-to-auto-sklearn-automl-for-machine-learning-practitioners#0001-01-01</a></blockquote><div><div class="l-content content-wrapper js-content">
            
<p>在现实世界中使用AutoML框架正成为机器学习从业者的一件常规事情。人们经常会问:自动化机器学习(<a href="https://web.archive.org/web/20221207184547/https://www.automl.org/automl/" target="_blank" rel="noreferrer noopener nofollow"> AutoML </a>)会取代数据科学家吗？</p>



<p>不完全是。如果您渴望了解AutoML是什么以及它是如何工作的，请加入我的这篇文章。我将向您展示auto-sklearn，一个最先进的开源AutoML框架。</p>



<p>为此，我必须做一些研究:</p>



<ul><li>阅读auto-sklearn <a href="https://web.archive.org/web/20221207184547/https://link.springer.com/chapter/10.1007/978-3-030-05318-5_6" target="_blank" rel="noreferrer noopener nofollow"> V1 </a>和<a href="https://web.archive.org/web/20221207184547/https://arxiv.org/abs/2007.04074" target="_blank" rel="noreferrer noopener nofollow"> V2 </a>的第一篇和第二篇论文。</li><li>深入研究了<a href="https://web.archive.org/web/20221207184547/https://automl.github.io/auto-sklearn/master/index.html" target="_blank" rel="noreferrer noopener nofollow"> auto-sklearn文档</a>和<a href="https://web.archive.org/web/20221207184547/https://automl.github.io/auto-sklearn/master/examples/index.html" target="_blank" rel="noreferrer noopener nofollow">示例</a>。</li><li>查看了官方汽车Sklearn博客帖子。</li><li>我自己做了一些实验。</li></ul>



<p>AutoML research也是如此，到目前为止我已经学到了很多。读完这篇文章后，你会更了解:</p>



<ul><li>AutoML是什么，AutoML是为谁服务的？</li><li>为什么auto-sklearn对ML社区很重要？</li><li>如何在实践中使用auto-sklearn？</li><li>auto-sklearn的主要特点是什么？</li><li>Neptune中带有结果跟踪的auto-sklearn的一个用例。</li></ul>



<p>开始吧！</p>



<h2 id="automated-ml">自动化机器学习</h2>



<p>AutoML是一个年轻的领域。AutoML社区希望建立一个自动化的工作流，它可以将原始数据作为输入，并自动生成预测。</p>



<p>这个自动化的工作流程应该自动执行预处理、模型选择、超参数调整以及ML过程的所有其他阶段。例如，看看下图，看看微软Azure是如何使用AutoML的。</p>







<p>AutoML可以提高数据科学家的工作质量，但不会将数据科学家排除在循环之外。</p>



<p>专家可以使用AutoML通过专注于表现最好的管道来提高他们的工作表现，而非专家可以使用AutoML系统而无需广泛的ML教育。如果你有15分钟的空闲时间，下面的对话可能会帮助你理解AutoML是怎么回事。</p>



<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><p class="wp-block-embed__wrapper"><iframe loading="lazy" title="What is AutoML? A conversation with Gnosis Data Analysis" src="https://web.archive.org/web/20221207184547if_/https://www.youtube.com/embed/SEwxvjfxxmE?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">视频</iframe></p></figure>



<p><a href="https://web.archive.org/web/20221207184547/https://youtu.be/SEwxvjfxxmE"/></p>



<p class="has-text-align-center"><em> <a href="https://web.archive.org/web/20221207184547/https://youtu.be/SEwxvjfxxmE" target="_blank" rel="noreferrer noopener nofollow">什么是AutoML:约什·斯塔默与约安尼斯·察马迪诺的对话</a> </em></p>



<h2 id="automl-frameworks">AutoML框架</h2>



<p>有不同类型的AutoML框架，每一种都有独特的特性。他们每个人都自动化了完整机器学习工作流的几个步骤，从预处理到模型开发。在这张表中，我只总结了其中值得一提的几条:</p>



<p id="separator-block_61ae158cb7b59" class="block-separator block-separator--20">自动sklearn</p>







<p id="separator-block_60255bb83a539" class="block-separator block-separator--20">auto-sklearn是一个基于<a href="https://web.archive.org/web/20221207184547/https://docs.neptune.ai/integrations-and-supported-tools/model-training/sklearn" target="_blank" rel="noreferrer noopener"> scikit-Learn </a>的AutoML框架。这是最先进的，而且是开源的。</p>



<h2 id="auto-sklearn">auto-sklearn结合了强大的方法和技术，帮助创作者赢得了第一届和第二届国际汽车挑战赛。</h2>



<p><strong> auto-sklearn基于将AutoML定义为现金问题。</strong></p>



<p>CASH =组合算法选择和超参数优化。简而言之，我们希望在一个巨大的搜索空间中找到数据集的最佳ML模型及其超参数，其中包括大量的分类器和大量的超参数。在下图中，您可以看到由作者提供的auto-sklearn的表示。</p>



<p><strong>auto-sklearn is based on defining AutoML as a CASH problem.</strong> </p>



<p>auto-sklearn可以解决分类和回归问题。auto-sklearn的第一个版本是在2015年第28届神经信息处理系统国际会议上，以一篇题为“<a href="https://web.archive.org/web/20221207184547/https://link.springer.com/chapter/10.1007/978-3-030-05318-5_6" target="_blank" rel="noreferrer noopener nofollow">高效和健壮的自动化机器学习</a>”的文章推出的。第二个版本在2020年随论文“<a href="https://web.archive.org/web/20221207184547/https://arxiv.org/abs/2007.04074" target="_blank" rel="noreferrer noopener nofollow"> auto-sklearn 2.0:下一代</a>”一同亮相。</p>







<p class="has-text-align-center">Auto-sklearn功能</p>



<p>auto-sklearn能为用户做些什么？它有几个有价值的特性，对新手和专家都有帮助。</p>



<h3>只需编写五行Python代码，初学者就可以看到预测，专家可以提高他们的工作效率。以下是auto-sklearn的一些主要功能:</h3>



<p>用Python编写，在最流行的ML库(scikit-learn)之上。</p>



<p>适用于许多任务，如分类、回归、多标签分类。</p>



<ul><li>由几种预处理方法组成(处理缺失值，规范化数据)。</li><li>在相当大的搜索空间(15个分类器，超过150个超参数被搜索)中搜索最佳ML管线。</li><li>由于使用了元学习，贝叶斯优化，集成技术。</li><li>auto-sklearn是如何工作的？</li><li>Auto-sklearn可以解决分类和回归问题，但是怎么做呢？机器学习管道中有很多东西。总的来说，V1自动sklearn有三个主要组成部分:</li></ul>



<h3>元学习</h3>



<p>贝叶斯优化</p>



<ol><li>构建合奏</li><li>因此，当我们想要对新数据集应用分类或回归时，auto-sklearn首先提取其元特征，以找到新数据集与依赖元学习的知识库的相似性。</li><li>在下一步中，当搜索空间通过元学习缩小到足够大时，贝叶斯优化将试图找到并选择表现优异的ML管道。在最后一步中，auto-sklearn将基于搜索空间中的最佳ML工作流来构建集成模型。</li></ol>



<p>Auto-sklearn v2:新一代</p>



<p>最近auto-sklearn第二版上市了。让我们来回顾一下新一代的变化。在官方<a href="https://web.archive.org/web/20221207184547/https://www.automl.org/auto-sklearn-2-0-the-next-generation/" target="_blank" rel="noreferrer noopener nofollow">博文</a>和原<a href="https://web.archive.org/web/20221207184547/https://arxiv.org/abs/2007.04074" target="_blank" rel="noreferrer noopener nofollow">论文</a>的基础上，有四点改进:</p>



<h3>他们允许每个ML管道在整个搜索空间内使用提前停止策略；该特性提高了大型数据集的性能，但它主要用于基于树的分类器。</h3>



<p>改进模型选择策略:auto-sklearn的一个重要步骤是如何选择模型。在V2的auto sklearn中，他们使用了BOHB等多保真优化方法。然而，他们表明，单一的模型选择并不适合所有类型的问题，他们整合了几种策略。为了熟悉新的优化方法，你可以阅读这篇文章:“<a href="/web/20221207184547/https://neptune.ai/blog/hyperband-and-bohb-understanding-state-of-the-art-hyperparameter-optimization-algorithms" target="_blank" rel="noreferrer noopener"> HyperBand和BOHB:了解最先进的超参数优化算法</a>”</p>



<ul><li>建立一个投资组合，而不是使用元特征在知识库中查找相似的数据集。您可以在下图中看到这种改进。</li><li>在之前的改进基础上构建自动化策略选择，以选择最佳策略。</li><li>Auto-sklearn主要参数</li><li>虽然Auto-sklearn可能能够在不设置任何参数的情况下找到一个表现更好的管道，但是有一些参数可以用来提高您的生产率。要检查所有参数，请访问<a href="https://web.archive.org/web/20221207184547/https://automl.github.io/auto-sklearn/master/api.html">官方页面</a>。</li></ul>







<h3> </h3>



<p>参数名称</p>



<p id="separator-block_61ae1841b7ba0" class="block-separator block-separator--20">缺省值</p>



<div id="medium-table-block_61ae194db7ba1" class="block-medium-table c-table__outer-wrapper ">

    <table class="c-table">
                    <thead class="c-table__head">
            <tr>
                                    <td class="c-item">
                        <p class="c-item__inner">描述</p>
                    </td>
                                    <td class="c-item">
                        <p class="c-item__inner">                                                      </p>
                    </td>
                                    <td class="c-item">
                        <p class="c-item__inner">                                                      </p>
                    </td>
                            </tr>
            </thead>
        
        <tbody class="c-table__body">

                    
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>显示试衣后的模特是否</p> </div></td>

                    
                        <td class="c-ceil">显示试衣后的模特</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>显示任务还剩多少秒。如果你增加它，获得更好性能的机会也会增加</p> </div></td>

                    
                        <td class="c-ceil">它显示任务还剩多少秒。如果您增加它，获得更好性能的机会也会增加</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>显示每个ML模型应该花费多少秒</p> </div></td>

                    
                        <td class="c-ceil">它显示了每个ML模型应该花费多少秒</td>

                    
                        <td class="c-ceil"><div class="c-ceil__inner"><p>initial _ configuration s _ viarn _ metal learning</p>T3】</div></td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil">                                                      </td>

                    
                        <td class="c-ceil">有多少通过元学习的配置考虑了超参数优化。如果设置为0，此选项将处于非活动状态。此外，该参数在自动sklearn V2中不可用</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>集合中模特的数量。要禁用该参数，将其设置为1</p>T3</div></td>

                    
                        <td class="c-ceil">集合中模特的数量。要禁用此参数，请将其设置为1</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>并行作业的数量。要使用所有处理器，将它设置为-1</p>T3</div></td>

                    
                        <td class="c-ceil">并行作业的数量。要使用所有处理器，请将其设置为-1</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>建立集合模型的最佳模型数。仅当ensemble_size大于1</p>T3时有效</div></td>

                    
                        <td class="c-ceil">建立集合模型的最佳模型数。仅在ensemble_size大于1时有效</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>当没有估值器时，它将使用所有估值器。auto-sk learn V2</p>T3不提供</div></td>

                    
                        <td class="c-ceil">当没有估值器时，它将使用所有估值器。不适用于V2 auto-sk learn</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>你可以从搜索空间中排除一些估值器。auto-sk learn V2</p>T3不提供</div></td>

                    
                        <td class="c-ceil">您可以从搜索空间中排除一些评估者。不适用于V2 auto-sk learn</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>如果不定义指标，则根据任务选择。在本文中，我们将其定义为(autosklearn . metrics . roc _ AUC)</p></div></td>

                    
                        <td class="c-ceil">如果不定义指标，将根据任务选择指标。在本文中，我们定义它(autosklearn.metrics.roc_auc)</td>

                    
                        <td class="c-ceil"> </td>

                    
                </tr>

                    
        </tbody>
    </table>

</div>



<p id="separator-block_60255be13a53a" class="block-separator block-separator--20">跟踪海王星上的Auto-sklearn实验</p>



<p>我做了一些<a href="https://web.archive.org/web/20221207184547/https://ui.neptune.ai/mjbahmani/auto-sklearn/notebooks" target="_blank" rel="noreferrer noopener nofollow">笔记本</a>，你可以轻松下载并自己做实验。但是，要再次完成所有步骤，您需要:</p>



<h2 id="auto-sklearn-tracking-neptune"><a href="https://web.archive.org/web/20221207184547/https://ui.neptune.ai/mjbahmani/auto-sklearn" target="_blank" rel="noreferrer noopener">检查海王星的所有实验</a></h2>



<p>首先，你需要在你的机器上安装auto-sklearn。为此只需使用pip3:</p>











<p class="has-text-align-center">如果你得到一个错误，你可能需要安装依赖项，所以请检查官方的<a href="https://web.archive.org/web/20221207184547/https://automl.github.io/auto-sklearn/master/installation.html" target="_blank" rel="noreferrer noopener nofollow">安装页面</a>。你也可以用我在海王星为你准备的<a href="https://web.archive.org/web/20221207184547/https://ui.neptune.ai/mjbahmani/auto-sklearn/notebooks" target="_blank" rel="noreferrer noopener nofollow">笔记本</a>。然后运行以下命令以确保安装正确完成:</p>



<p>让我们解决一些分类和回归问题。</p>



<pre class="hljs">pip3 install auto-sklearn
</pre>



<p>用于分类的Auto-sklearn</p>



<pre class="hljs"><span class="hljs-keyword">import</span> autosklearn
print(autosklearn.__version__)

</pre>



<p>对于分类问题，我选择了一个珍爱的Kaggle竞赛——<a href="https://web.archive.org/web/20221207184547/https://www.kaggle.com/c/santander-customer-transaction-prediction/data" target="_blank" rel="noreferrer noopener nofollow">桑坦德客户交易预测</a>。请下载数据集并随机选择10000条记录。然后按照第一个<a href="https://web.archive.org/web/20221207184547/https://ui.neptune.ai/mjbahmani/auto-sklearn/n/neptune-autosklearn-v1" target="_blank" rel="noreferrer noopener nofollow">笔记本里的实验</a>:</p>



<h3>我们还需要定义一些配置，以便更深入地了解auto-sklearn:</h3>



<p> </p>



<pre class="hljs">
<span class="hljs-keyword">import</span> autosklearn
X_train=<span class="hljs-keyword">None</span>
X_val=<span class="hljs-keyword">None</span>
y_train=<span class="hljs-keyword">None</span>
y_val=<span class="hljs-keyword">None</span>
train=pd.read_csv(<span class="hljs-string">"./sample_train_Santander.csv"</span>)
X=train.drop([<span class="hljs-string">"ID_code"</span>,<span class="hljs-string">'target'</span>],axis=<span class="hljs-number">1</span>)
y=train[<span class="hljs-string">"target"</span>]
X_train,X_val,y_train,y_val = train_test_split(X,y, stratify=y,test_size=<span class="hljs-number">0.33</span>, random_state=<span class="hljs-number">42</span>)

automl = autosklearn.classification.AutoSklearnClassifier()

automl.fit(X_train, y_train )

y_pred=automl.predict_proba(X_val)

score=roc_auc_score(y_val,y_pred[:,<span class="hljs-number">1</span>])
print(score)

show_modes_str=automl.show_models()
sprint_statistics_str = automl.sprint_statistics()
</pre>



<p>配置</p>



<p id="separator-block_61ae1b17b7bcd" class="block-separator block-separator--20">范围值</p>



<div id="medium-table-block_61ae1b2db7bce" class="block-medium-table c-table__outer-wrapper ">

    <table class="c-table">
                    <thead class="c-table__head">
            <tr>
                                    <td class="c-item">
                        <p class="c-item__inner">描述</p>
                    </td>
                                    <td class="c-item">
                        <p class="c-item__inner">                                                      </p>
                    </td>
                                    <td class="c-item">
                        <p class="c-item__inner">                                                      </p>
                    </td>
                            </tr>
            </thead>
        
        <tbody class="c-table__body">

                    
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>我用60秒开始实验，然后对于每个实验，我把它增加到5000 </p> </div></td>

                    
                        <td class="c-ceil">我以60秒开始实验，然后对于每个实验，我把它增加到5000秒</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>由于案例研究高度不平衡，那么我需要将指标改为roc_auc </p> </div></td>

                    
                        <td class="c-ceil">由于案例研究非常不平衡，因此我需要将指标改为roc_auc</td>

                    
                        <td class="c-ceil">                                                      </td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>在auto-sklearn V1中，如果我没有定义重采样_策略，就无法得到好的结果。但在auto-sklearn V2中，它自动做到了</p> </div></td>

                    
                        <td class="c-ceil">在auto-sklearn V1中，如果我没有定义重采样_策略，它不能得到一个好的结果。但是在V2的auto-sklearn中，它是自动完成的</td>

                    
                        <td class="c-ceil"><div class="c-ceil__inner"> <p>重采样_策略_自变量</p> </div></td>

                    
                </tr>

            
                <tr class="c-row">

                    
                        <td class="c-ceil">                                                      </td>

                    
                        <td class="c-ceil"> </td>

                    
                        <td class="c-ceil">
                            <p class="c-ceil__inner">要使用上述配置，您可以如下定义automl对象:</p>
                        </td>

                    
                </tr>

                    
        </tbody>
    </table>

</div>



<p id="separator-block_60255c6b3a53b" class="block-separator block-separator--20">由于我使用了大量不同的配置，我只是在海王星上跟踪它们。你可以在图像中看到其中的一个，在<a href="https://web.archive.org/web/20221207184547/https://ui.neptune.ai/mjbahmani/auto-sklearn/e/AUT1-17/logs" target="_blank" rel="noreferrer noopener">海王星</a>中查看全部。</p>



<p>当您安装auto-sklearn模型时，您可以使用<a href="https://web.archive.org/web/20221207184547/https://pypi.org/project/pipelineprofiler/" target="_blank" rel="noreferrer noopener nofollow"> PipelineProfiler </a> (pip安装PipelineProfiler)检查所有表现最佳的管道。为此，您需要运行以下代码:</p>



<pre class="hljs">
TIME_BUDGET=<span class="hljs-number">60</span>
automl = autosklearn.classification.AutoSklearnClassifier(
time_left_for_this_task=TIME_BUDGET,
metric=autosklearn.metrics.roc_auc,
n_jobs=<span class="hljs-number">-1</span>,
resampling_strategy=<span class="hljs-string">'cv'</span>,
resampling_strategy_arguments={<span class="hljs-string">'folds'</span>: <span class="hljs-number">5</span>},
)



automl.fit(X_train, y_train )
</pre>



<p>您的输出应该如下所示:</p>







<p>另一方面，我也运行了一些基于auto-sklearn V2的实验。结果令人着迷。您可以看到下面的结果:</p>



<pre class="hljs"><span class="hljs-keyword">import</span> PipelineProfiler

profiler_data= PipelineProfiler.import_autosklearn(automl)
PipelineProfiler.plot_pipeline_matrix(profiler_data)</pre>



<p>要使用auto-sklearn V2，您可以使用以下代码:</p>







<p>用于回归的自动sklearn</p>







<p>auto-sklearn可以解决的第二类问题是回归。我基于auto-sklearn <a href="https://web.archive.org/web/20221207184547/https://automl.github.io/auto-sklearn/master/examples/index.html" target="_blank" rel="noreferrer noopener nofollow">文档</a>中的官方示例运行了一些实验。</p>



<pre class="hljs">TIME_BUDGET=<span class="hljs-number">60</span>
automl = autosklearn.experimental.askl2.AutoSklearn2Classifier(
time_left_for_this_task=TIME_BUDGET,
n_jobs=<span class="hljs-number">-1</span>,
metric=autosklearn.metrics.roc_auc,
)
</pre>



<h3>我只是改变了时间预算来跟踪基于时间限制的性能。下图显示了结果。</h3>



<p>最终想法</p>



<pre class="hljs">TIME_BUDGET=<span class="hljs-number">60</span>
automl = autosklearn.regression.AutoSklearnRegressor(
time_left_for_this_task=TIME_BUDGET,
n_jobs=<span class="hljs-number">-1</span>
)
automl.fit(X_train, y_train, dataset_name=<span class="hljs-string">'boston'</span>)
y_pred = automl.predict(X_test)
score=r2_score(y_test, y_pred)
print(score)
show_modes_str=automl.show_models()
sprint_statistics_str = automl.sprint_statistics()

print(show_modes_str)
print(sprint_statistics_str)
</pre>



<p>总的来说，auto-sklearn还是一项新技术。因为auto-sklearn是建立在scikit-learn之上的，所以许多ML从业者可以很快尝试一下，看看它是如何工作的。</p>







<h2 id="automl-final">这个框架最重要的优点就是为专家节省了大量的时间。一个缺点是它像一个黑盒，并没有说明如何做决定。</h2>



<p>总而言之，这是一个相当有趣的工具，所以值得给auto-sklearn看一看。</p>



<p>The most important advantage of this framework is that it saves a lot of time for experts. The one weakness is that it acts as a black box, and doesn’t say anything about how to make a decision.</p>



<p>All in all, it’s a pretty interesting tool, so it’s worth giving auto-sklearn a look.</p>
        </div>
        
    </div>    
</body>
</html>