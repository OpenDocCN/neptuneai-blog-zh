<html>
<head>
<title>Deploying ML Models: How to Make Sure the New Model Is Better Than the One in Production? [Practical Guide] </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>部署ML模型:如何确保新模型比生产中的模型更好？[实用指南]</h1>
<blockquote>原文：<a href="https://web.archive.org/web/https://neptune.ai/blog/deploying-ml-models-make-sure-new-model-is-better#0001-01-01">https://web.archive.org/web/https://neptune.ai/blog/deploying-ml-models-make-sure-new-model-is-better#0001-01-01</a></blockquote><div><div class="article__content col-lg-10">
<p>让我们假设我们正在进行一个与ML相关的项目，并且第一个ML模型已经成功地部署到生产中，遵循了大多数MLOps实践。好吧，但是现在怎么办？我们完成工作了吗？</p>



<p>我假设你们大多数人都知道答案是什么，当然，答案是否定的。我们预计，由于模型陈旧或数据漂移，该模型不会永远正常工作。而且，模型不需要自己变坏，说不定还能产生新的更好的模型！</p>



<p>等等，但是更好的模型是什么意思呢？在测试集上准确率更高的模型？还是嵌套，分层，k折，什么交叉验证后精度更高的模型？</p>



<p>嗯，可能不会。答案要复杂得多，尤其是对于生产中的更好的模型。</p>



<p>在本文中，我们将解释如何确保您的新模型比生产中的模型更好。我们将尝试提及所有可能影响决定更好模型的因素。除此之外，重点将放在模型的生产上，还将介绍一些部署新模型的技术。</p>



<h2>为什么以及何时需要在生产中部署新的ML模型？</h2>



<p>ML项目是高度依赖于输入数据的动态系统。与传统软件相比，大多数软件会随着时间的推移而退化，或者变得越来越不相关。这个问题也被称为模型过时。ML模型在生产中部署后可能发生的一些问题是:</p>


<div class="custom-point-list">
<ul><li><strong>数据漂移</strong>–当输入特征(即独立变量)的分布与模型在训练中观察到的情况发生剧烈变化时。</li><li><strong>模型或<a href="/web/20221002071951/https://neptune.ai/blog/concept-drift-best-practices" target="_blank" rel="noreferrer noopener">概念漂移</a></strong>——当目标变量即因变量的性质发生变化而不改变输入特性时。</li><li><strong>培训-服务偏差</strong>-生产中的模型，与培训的性能不同。</li><li><strong>技术bug</strong>等类似的东西。</li></ul>
</div>


<p>为了及时发现这些问题并采取行动，我们需要实施相关的监控策略。</p>





<div class="wp-block-image">
<figure class="aligncenter size-full"><img data-attachment-id="70741" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=980%2C605&amp;ssl=1" data-orig-size="980,605" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=300%2C185&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=980%2C605&amp;ssl=1" src="../Images/11366adf2d3e2807fc57a692231d044a.png" alt="Model staleness monitoring " class="wp-image-70741 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?resize=980%2C605&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?resize=980%2C605&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70741" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=980%2C605&amp;ssl=1" data-orig-size="980,605" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=300%2C185&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?fit=980%2C605&amp;ssl=1" src="../Images/11366adf2d3e2807fc57a692231d044a.png" alt="Model staleness monitoring " class="wp-image-70741" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-1.png?resize=980%2C605&amp;ssl=1"/></noscript><figcaption><em>Model monitoring and retraining | Source: Author</em></figcaption></figure></div>


<p>除了监控之外，解决模型陈旧的方法是实施再培训策略。模型再训练的时间取决于业务用例，但是通常有四种不同的方法:</p>


<div class="custom-point-list">
<ul><li><strong>基于时间间隔</strong>–每天、每周、每月或类似时间重新训练模型。</li><li><strong>基于性能的</strong>–当模型的性能低于预定义的阈值时，重新训练模型。</li><li><strong>基于数据变化</strong>–在重大数据变化或引入新功能后触发培训。</li><li><strong>按需重新培训</strong>–出于其他原因手动重新培训模型。</li></ul>
</div>





<p>但再训练毕竟只是作为数据和概念漂移问题的急救手段。很可能在几次重新训练迭代之后，模型将不会达到它以前拥有的最大性能。此外，如果重新训练逻辑基于模型性能，则模型重新训练之间的时间间隔可能会变得更短。</p>



<p>当再培训变得越来越低效时，这是一个信号，表明我们需要考虑一种新的模式。而且新的模型需要按时准备，因为我们不想等到最后一分钟，模型才完全停止良好的表现。</p>



<p>一般来说，当开发团队确信一个新的生产模型满足了所有被推向生产的需求时，可以在任何时候部署这个新的生产模型。我们不一定需要等到生产中的旧模式变得无用。</p>



<p>但是在部署新模型之前，我们需要确保它确实比旧模型更好。<strong>即使从各个角度来看，开发中的新模型似乎比旧模型更好，直接部署它们也是不安全的</strong>。</p>



<p>在下面的小节中，我们将讨论一些部署新模型的技术和最佳实践。</p>



<h2>如何比较ML车型？</h2>



<p>要知道哪种模式“更好”是一项非常具有挑战性的任务。立即出现的一个大挑战是过度拟合。当最大似然模型过于接近训练数据时，就会出现问题，这会导致在新数据上表现不佳。这甚至可能发生在有经验的机器学习实践者身上，因为过度拟合和良好拟合之间没有明确的界限。</p>


<div class="wp-block-image">
<figure class="aligncenter size-full"><img data-attachment-id="70742" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=640%2C480&amp;ssl=1" data-orig-size="640,480" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=300%2C225&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=640%2C480&amp;ssl=1" src="../Images/dae31b3449b3069169aff9927933a6a4.png" alt="Overfitting meme " class="wp-image-70742 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?resize=640%2C480&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?resize=640%2C480&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70742" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=640%2C480&amp;ssl=1" data-orig-size="640,480" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=300%2C225&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?fit=640%2C480&amp;ssl=1" src="../Images/dae31b3449b3069169aff9927933a6a4.png" alt="Overfitting meme " class="wp-image-70742" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-2.jpg?resize=640%2C480&amp;ssl=1"/></noscript><figcaption><em>Overfitting challenge | <a href="https://web.archive.org/web/20221002071951/https://memegenerator.net/instance/74939662/futurama-fry-not-sure-if-good-model-or-just-overfitting" target="_blank" rel="noreferrer noopener nofollow">Source</a></em></figcaption></figure></div>


<p>另一个挑战是为模型评估选择正确的指标，这将考虑所有的业务需求。例如，<a href="https://web.archive.org/web/20221002071951/https://www.wired.com/2012/04/netflix-prize-costs/" target="_blank" rel="noreferrer noopener nofollow">网飞在2009年给一个开发团队颁发了100万美元的奖金</a>，奖励他将网飞的推荐算法提高了10%。最终，他们从未使用过这种解决方案，因为这种解决方案太复杂，无法部署到生产中，而且工程成本不值得。</p>






<h3>模型评估指标</h3>



<p>在生产中部署新模型之前，我们需要确保开发中的新模型比旧模型更好。有许多不同的评估指标可用于比较模型，选择正确的指标至关重要。这里就讨论几个比较流行的。</p>



<h4>分类指标</h4>



<p>说到分类指标，选择指标时要考虑的主要因素是:</p>


<div class="custom-point-list">
<ul><li>类别数量——二元或多元分类。</li><li>每堂课的样本数量——我们有一个平衡的数据集吗？</li><li>业务用例——例如，根据业务用例平衡精确度和召回率。</li></ul>
</div>


<p>最常用的分类标准是准确性。对于更不平衡的数据集，使用F1、精度和召回率等指标。所有这些以及更多都可以从混乱矩阵中计算出来。对于多类分类，使用相似的度量标准，但公式略有不同。为了利用预测类别的概率，使用诸如ROC和AUC的度量。</p>



<h4>回归度量</h4>



<p>回归<strong> </strong>度量通常会计算出预测值和地面真实值之间的某种距离，用误差来表示。最常用的回归指标是:</p>


<div class="custom-point-list">
<ul><li>均方误差</li><li>平均绝对误差</li><li>均方根误差(RMSE)</li><li>平均绝对百分比误差(MAPE)</li><li>r平方</li></ul>
</div>


<h4>推荐系统指标</h4>



<p>另一方面，推荐系统和搜索引擎中使用的排名算法有自己的一套衡量标准。其中一些是:</p>


<div class="custom-point-list">
<ul><li>平均倒数排名(MRR)</li><li>命中率(小时)</li><li>标准化贴现累积收益(NDCG)</li><li>平均精度</li></ul>
</div>


<h4>相似性度量</h4>



<p>最后，当涉及到无人监督的问题时，相似性度量总是有用的。最常见的有:</p>


<div class="custom-point-list">
<ul><li>欧几里得距离</li><li>余弦相似性</li><li>莱文斯坦距离</li><li>雅克卡相似性</li></ul>
</div>


<p>还有一些其他指标与<strong>计算机视觉</strong>项目更相关，如交集超过联合(IoU)和结构相似性(SSIM)，其中一些与<strong> NLP </strong>相关，如双语评估替角(BLEU)和困惑(PP)。</p>






<h3>操作指标</h3>



<p>除了性能指标之外，还有一些其他指标在模型比较过程中也很重要。这方面的一个例子是我们前面提到的网飞100万美元奖金。</p>



<p>许多技术人员忘记了一件事，那就是他们正在构建的产品的商业价值。如果一个简单的线性回归模型或几个决策树就可以很好地解决问题，为什么要开发一些繁重的神经网络模型并花费大量资源呢？此外，像我们是否有预算在云GPU机器上维护和运行沉重的模型，以及是否值得比更简单的模型高0.5%的准确性这样的问题的答案也很重要。</p>



<p>因此，我们需要注意一些流行的业务指标:</p>


<div class="case-study-numbered-list">
    <h2/>
    <ul>
                    <li><span> 1 </span>点击率<br/></li>
                    <li><span> 2 </span>转换率<br/></li>
                    <li><span> 3 </span>上市时间<br/></li>
                    <li><span> 4 </span>软硬件成本<br/></li>
                    <li><span> 5 </span>用户行为和参与度</li>
            </ul>
</div>



<p>在开发和部署ML模型之前，我们需要记住一些技术<strong> </strong>需求，比如计算时间和基础设施支持。例如，一些ML模型可能需要比生产中可行的更多的时间来训练。或者，使用R开发模型并不是集成到现有MLOps管道中的最佳选择。</p>



<p>最后，我们必须指出在部署ML模型之前进行测试的重要性。这是捕捉生产中可能发生的错误的好方法。最常用的测试包括:</p>


<div class="custom-point-list">
<ul><li><strong>冒烟测试</strong>–运行整个管道，确保一切正常。</li><li><strong>单元测试</strong>–测试项目的独立组件。</li><li><strong>集成测试</strong>–确保项目的组件在组合时能够正确交互。</li></ul>
</div>





<h3>ML验证技术</h3>



<p>为了实现一般化并且不过度拟合数据，应用兼容的验证策略是很重要的。这对于防止新数据输入的性能下降是必要的。</p>



<p>为了实现欠拟合和过拟合之间的平衡，我们使用不同的<strong>交叉验证</strong>策略。交叉验证是一种统计方法，用于在ML算法投入生产之前对其进行性能评估。一些最受欢迎的是:</p>


<div class="case-study-numbered-list">
    <h2/>
    <ul>
                    <li><span> 1 </span>坚持(列车试运行)<br/></li>
                    <li><span> 2 </span> K倍<br/></li>
                    <li><span> 3 </span>留一手<br/></li>
                    <li><span> 4 </span>分层K折<br/></li>
                    <li><span> 5 </span>嵌套K折<br/></li>
                    <li><span> 6 </span>时间序列CV</li>
            </ul>
</div>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img data-attachment-id="70743" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=631%2C296&amp;ssl=1" data-orig-size="631,296" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=300%2C141&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=631%2C296&amp;ssl=1" src="../Images/7d6db5e992a658c6d42247d54e85c9b1.png" alt="Cross-validation" class="wp-image-70743 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?resize=631%2C296&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?resize=631%2C296&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70743" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=631%2C296&amp;ssl=1" data-orig-size="631,296" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=300%2C141&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?fit=631%2C296&amp;ssl=1" src="../Images/7d6db5e992a658c6d42247d54e85c9b1.png" alt="Cross-validation" class="wp-image-70743" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-3.png?resize=631%2C296&amp;ssl=1"/></noscript><figcaption><em>Time series cross-validation | <a href="https://web.archive.org/web/20221002071951/https://stats.stackexchange.com/questions/14099/using-k-fold-cross-validation-for-time-series-model-selection" target="_blank" rel="noreferrer noopener nofollow">Source</a></em></figcaption></figure></div>


<p>有时候，正确地实现一份简历是很棘手的。我们需要避免的常见错误有:</p>


<div class="custom-point-list">
<ul><li>对于<a href="https://web.archive.org/web/20221002071951/https://www.baeldung.com/cs/k-fold-cross-validation" target="_blank" rel="noreferrer noopener nofollow"> k倍CV </a>，使用不同的k值进行灵敏度分析，以观察结果在不同验证中的表现。</li><li>倾向于分层验证，以便在每个文件夹中有平衡的类。</li><li>注意数据泄露。</li><li>对于时间序列，不要验证过去的数据。</li></ul>
</div>





<h2>如何在生产中部署新的ML模型？</h2>



<p>ML模型部署是将模型集成到现有生产环境中以做出实际业务决策的过程。ML模型几乎总是需要部署来提供商业价值，但是不幸的是，大多数模型从来没有投入生产。部署和维护任何软件都不是一项简单的任务，部署ML解决方案会带来更多的复杂性。正因为如此，MLOps的重要性上升了。</p>



<p>我们使用的模型部署策略有可能将我们从昂贵的和不想要的错误中拯救出来。这对于ML系统尤其重要，在这种系统中，检测生产中的数据或模型错误可能非常困难，并且可能需要大量的“挖掘”。此外，在许多情况下，精确复制生产数据输入可能很困难。</p>



<p>为了缓解这些问题，并确保新模型在各个方面都优于旧模型，创建了一些部署策略。它们中的大部分来自一般的软件行业，但是为了ML的目的稍微修改了一下。在本教程中，我们将解释ML中一些最常用的部署方法。</p>



<h3>影子部署</h3>



<p>影子部署是一个概念，不仅在ML中使用，而且在一般的软件开发行业中使用。这是一种部署策略，我们在实时部署之前将应用程序部署到单独的环境中。影子部署通常被公司用来在向公众发布应用程序之前测试它们的性能。这种类型的部署可以在小规模和大规模上进行，但在部署大型应用程序时尤其有用，因为它们有很多依赖项，容易出现人为错误。</p>



<h4>影子部署的优势</h4>



<p>随着影子部署，我们将能够测试一些事情，如:</p>


<div class="custom-point-list">
<ul><li>整个管道的功能——模型收到预期的输入了吗？模型输出结果的格式是否正确？整个过程的延迟是多少？</li><li>模型的行为，以防止在实际生产中出现意外和昂贵的决策。</li><li>与实时模型相比，阴影模型的性能。</li></ul>
</div>


<p>即使从一般的角度来看，在生产环境中进行测试也比在ML中使用沙盒或登台环境有很多好处。例如:</p>


<div class="custom-point-list">
<ul><li>在非生产环境中创建真实的数据是一项非常复杂的任务。对于更复杂的输入数据，如图像、流数据和医疗记录，为非生产环境创建包括所有可能的边缘情况的测试数据几乎是不可能的。</li><li>对于具有许多节点和集群机器的复杂设置，在非生产环境中测试相同的基础设施将是昂贵的，并且可能不值得。</li><li>维护非生产环境需要额外的资源。</li><li>对于实时ML系统，逼真地复制数据流量和模拟模型的频繁更新是一个挑战。</li><li>最后，如果ML模型在非生产环境中的行为和预期的一样，这并不意味着它在生产环境中的行为也一样。</li></ul>
</div>


<h4>影子部署怎么做？</h4>



<p>在应用程序级别，影子部署可能以简单明了的方式非常简单地实现。<strong> </strong>基本上，这是一个代码修改，将输入数据发送到ML模型的当前版本和新版本，保存两个版本的输出，但只返回当前版本的输出。在性能很重要的情况下，比如实时预测系统，最佳实践是异步传递输入和保存输出，首先是生产中的模型，然后是新模型。</p>



<p>与应用程序级别相反，在基础架构级别，影子部署可能有一些复杂的元素。例如，如果一些服务进行外部API调用，那么我们需要确保它们不会在两个模型中重复，以避免速度变慢和额外的开销。基本上，我们需要确保所有应该只发生一次的操作不会触发两次或更多次。如果我们影子部署不止一个新模型，这一点尤其重要，这也是可能的。</p>



<p>在保存了所有的模型输出和日志之后，我们使用一些度量来查看新模型是否更好。如果新型号证明更好，我们就安全地更换旧型号。</p>





<h3>A/B测试</h3>



<p>A/B测试是一种基于统计数据做出业务决策的技术，它被广泛用于测试给定特性相对于旧特性的转换率。在部署策略的情况下，想法是有两个独立的模型，即A和B，它们有两个我们想要测试的不同的特性或功能。当部署具有新特性或功能的模型时，用户流量的子集在特定条件下被重定向以测试该模型。</p>



<p>除了转换率，公司还使用A/B测试来衡量其他业务目标，例如:</p>


<div class="custom-point-list">
<ul><li>总收入</li><li>用户参与度</li><li>每次安装的成本</li><li>流失率和其他。</li></ul>
</div>


<p>为了对这两个模型进行无偏见的测试，应该谨慎地在它们之间分配流量。这意味着两个样本应该具有相同的统计特征，这样我们才能做出正确的决定。这些特征可能基于:</p>


<div class="custom-point-list">
<ul><li>人口属性，如性别、年龄、国家等</li><li>地理定位</li><li>浏览器cookies</li><li>技术类型，如设备类型、屏幕大小、操作系统等。</li></ul>
</div>


<p>与影子部署相反，A/B测试通常只用于测试一个单独的功能，以了解其真正的贡献。例如，模型中新特征的存在。它不适合一个有多种变化的新模型，因为我们无法确切知道哪个功能正在影响性能，以及它的贡献有多大。</p>



<h4>A/B测试的好处</h4>



<p>对于模型中的简单更改，A/B测试比影子部署要方便得多。此外，A/B测试和影子部署之间的主要区别在于，A/B测试中的流量在两个模型之间分配，而在影子部署中，两个模型使用相同的事件进行操作。这样，A/B测试消耗的资源至少减少了两倍。</p>



<h4>如何对ML车型进行A/B测试？</h4>



<p>第一步是确定我们希望实现的业务目标。这可能是我们上面提到的指标之一。</p>



<p>下一步是定义测试的参数:</p>


<div class="custom-point-list">
<ul><li>样本大小——用户流量如何在A和B模型之间分配？比如50/50，60/40等。</li><li>测试持续时间——定义达到测试预期显著性水平的截止日期。</li></ul>
</div>


<p>之后，我们需要做一些架构上的改变。一个好的方法是在用户请求和模型之间增加一个额外的抽象层。这一路由层负责将流量定向到托管在不同环境中的两个模型。基本上，路由层接受传入的请求，然后根据我们定义的实验设置将它们定向到我们的一个模型。所选模型将输出返回给路由层，路由层将输出返回给客户端。</p>


<div class="wp-block-image">
<figure class="aligncenter size-full"><img data-attachment-id="70745" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=983%2C796&amp;ssl=1" data-orig-size="983,796" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=300%2C243&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=983%2C796&amp;ssl=1" src="../Images/f0c8fbc1f19f9af8694973c94966bd12.png" alt="A/B test architecture" class="wp-image-70745 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?resize=983%2C796&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?resize=983%2C796&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70745" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=983%2C796&amp;ssl=1" data-orig-size="983,796" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=300%2C243&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?fit=983%2C796&amp;ssl=1" src="../Images/f0c8fbc1f19f9af8694973c94966bd12.png" alt="A/B test architecture" class="wp-image-70745" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-5.png?resize=983%2C796&amp;ssl=1"/></noscript><figcaption><em>One good A/B architecture | </em><a href="https://web.archive.org/web/20221002071951/https://mlinproduction.com/ab-test-ml-models-deployment-series-08/" target="_blank" rel="noreferrer noopener nofollow"><em>Source</em></a></figcaption></figure></div>


<h3>金丝雀部署</h3>



<p>canary部署的思想是向新模型发送一小部分请求，以验证它是否如预期的那样运行。仅使用一小部分流量，我们就能够验证新模型，检测潜在的错误和问题，而不会对大多数用户造成伤害。一旦我们确定新模型按预期工作，我们就可以逐渐增加流量，直到整个流量不切换到新模型。</p>



<p>总之，canary部署可以分为三个步骤:</p>


<div class="custom-point-list">
<ol><li>将流量的一个小的子样本导向一个新的模型。</li><li>验证模型是否按预期工作。如果没有，请执行回滚。</li><li>在将所有流量释放到新模型之前，重复前面的两个步骤，直到所有错误都得到解决并且验证完成。</li></ol>
</div>


<p>通常，当测试没有很好地实现或者对新模型没有信心时，使用这种技术。</p>



<h4>金丝雀部署的优势</h4>



<p>Canary deployment提供了一种根据生产中的真实数据测试新模型的简单方法。与影子部署相比，canary部署不要求所有流量都流向两个模型，正因为如此，它在模型推理资源方面便宜两倍。在失败的情况下，它只影响一小部分流量，如果实施得当，不会造成重大伤害。</p>



<h4>金丝雀部署怎么做？</h4>



<p>首先，我们需要定义canary部署将选择多少用户，在多少个阶段，以及canary部署的持续时间。与此同时，我们必须计划如何挑选用户的策略。一些可能的选项包括:</p>


<div class="custom-point-list">
<ul><li>随机用户选择</li><li>按地区-将金丝雀部署到一个地理区域。</li><li>早期采用者计划——让用户有机会作为测试者参与金丝雀测试。</li><li>dog fooding——首先向内部用户和员工发布canary模型。</li></ul>
</div>


<p>之后，我们需要指定我们将要使用的度量标准以及成功的评估标准。最佳选择标准可以结合几种不同的策略。例如，<a href="https://web.archive.org/web/20221002071951/https://www.infoq.com/presentations/Facebook-Release-Process/" target="_blank" rel="noreferrer noopener nofollow">脸书首先向员工部署</a>金丝雀，然后向一小部分用户部署。架构部分非常类似于A/B测试。我们需要一个路由层来控制模型之间的流量。此外，当第一只金丝雀的输出被分析时，我们将决定我们是否应该增加流量的百分比或放弃新的模型。</p>



<h3>功能标志</h3>



<p>特性标志，也称为特性切换，是快速安全地发布新特性的强大技术。特性标志的主要目的是打开或关闭功能，以便通过将代码部署与特性发布分开，在生产中进行安全测试。</p>



<p>其思想是将新模型或功能的代码集成到生产代码中，并使用功能标志来控制模型的流量，而不是花费资源来构建新的独立基础设施或额外的路由层。功能标志可分为不同类别的切换，其中主要类别有:</p>


<div class="custom-point-list">
<ul><li><strong>Release toggles</strong>–开发人员在主分支中生成一个Release toggles，让他们的代码在工作时保持非活动状态，而不是创建一个具有新特性的分支。</li><li><strong>实验切换</strong>–用于简化A/B测试。基本上，是集成到产品中的代码的一部分，用于划分模型之间的流量。</li><li><strong>操作开关</strong>–用于关闭功能。例如，如果不满足某些条件，操作开关会关闭我们之前部署的新功能。</li><li><strong>权限切换</strong>-旨在使某些功能对特定用户子集可用，如高级用户等。</li></ul>
</div>


<h4>功能标志的好处</h4>



<p>由于它们的简单性，当我们需要快速部署新的变化到我们的系统时，特性标志是有用的。在大多数情况下，它们是临时的解决方案，应该在变更测试完成后删除。</p>



<p>一旦实现，特性标志不仅可以由工程师和开发人员控制，也可以由产品经理、销售团队和市场团队控制。有了特性标志，就有可能在不回滚代码的情况下关闭在生产中意外执行的特性。</p>



<h4>如何实现特征标志？</h4>



<p>功能标志的范围从简单的if语句到更复杂的决策树。通常，它们直接在项目的主分支中实现。部署后，可以使用配置文件控制功能标志。例如，可以通过修改配置文件中的特定变量来关闭或打开操作标志。此外，许多公司使用CI/CD管道来逐步推出新功能。</p>



<h2>示例:影子部署</h2>



<p>作为一个例子，我们将展示如何影子部署一个简单的ML应用程序。首先，让我们在<a href="https://web.archive.org/web/20221002071951/https://aws.amazon.com/ec2/" target="_blank" rel="noreferrer noopener nofollow"> AWS EC2 </a>上部署一个简单的基于情感分析转换器的模型。该模型将从IMDB <a href="https://web.archive.org/web/20221002071951/https://huggingface.co/datasets/imdb" target="_blank" rel="noreferrer noopener nofollow">拥抱面部数据集</a>中随机接收文本段落，并将它们分类为积极情绪和消极情绪。情绪的结果将保存在<a href="https://web.archive.org/web/20221002071951/https://aws.amazon.com/s3/" target="_blank" rel="noreferrer noopener nofollow"> AWS S3 </a>桶中。</p>



<p>创建EC2实例的步骤:</p>


<div class="custom-point-list">
<ol><li>转到AWS -&gt; EC2 -&gt;启动实例</li><li>选择名称、实例类型，并为登录创建新的密钥对。</li><li>单击启动实例</li></ol>
</div>


<p>创建S3时段的步骤:</p>


<div class="custom-point-list">
<ol><li>转到AWS -&gt;亚马逊S3 -&gt;桶-&gt;创建桶</li><li>写入存储桶名称，并可选地启用存储桶版本控制。单击创建一个存储桶。</li></ol>
</div>


<p>为S3访问创建IAM用户的步骤:</p>


<div class="custom-point-list">
<ol><li>转到AWS -&gt; IAM -&gt;用户-&gt;添加用户</li><li>填写用户名，并在AWS访问类型下，选择“访问键-编程访问”,然后单击权限选项卡旁边的。</li><li>选择以下策略“AmazonS3FullAccess”</li><li>单击“下一步”按钮两次，然后单击“创建用户”。现在，将出现用户凭证，请确保下载并保存它们，因为您将无法再次看到它们。</li></ol>
</div>


<p>为了连接到创建的实例，请转到EC2，单击Instances，然后单击connect。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large"><img data-attachment-id="70746" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=1881%2C851&amp;ssl=1" data-orig-size="1881,851" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=300%2C136&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=1024%2C463&amp;ssl=1" src="../Images/892ba54544fd851a026830dbf9fd4127.png" alt="Instructions on connecting to the instance" class="wp-image-70746 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?resize=1024%2C463&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?resize=1024%2C463&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70746" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=1881%2C851&amp;ssl=1" data-orig-size="1881,851" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=300%2C136&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?fit=1024%2C463&amp;ssl=1" src="../Images/892ba54544fd851a026830dbf9fd4127.png" alt="Instructions on connecting to the instance" class="wp-image-70746" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-6.png?resize=1024%2C463&amp;ssl=1"/></noscript><figcaption><em>Instructions on how to connect to the instance | Source: Author</em></figcaption></figure></div>


<p>将出现如何连接到实例的说明。可以通过浏览器连接EC2实例，但是通常我们使用SSH连接从本地机器进行连接。在这种情况下，它是</p>



<pre class="hljs">ssh -i <span class="hljs-string">"sentiment_analysis.pem"</span> ec2-user@ec2<span class="hljs-number">-54</span><span class="hljs-number">-208</span><span class="hljs-number">-121</span><span class="hljs-number">-4.</span>compute<span class="hljs-number">-1.</span>amazonaws.com

</pre>



<p>其中“情绪分析. pem”是我们之前创建的登录密钥对的路径。</p>



<p>在这个例子中，我们使用一个EC2 Red Hat Linux实例，在连接到该实例后，我们需要更新包并安装python和git。</p>



<pre class="hljs">sudo yum update -y
sudo yum install python3 -y
sudo yum install git -y
</pre>



<p>此外，我们将使用python环境直接在机器上运行我们的项目。为此，我们需要安装virtualenv并创建一个环境。</p>



<pre class="hljs">pip3 install --user virtualenv
virtualenv venv
</pre>



<p>为了从EC2机器访问S3存储区，我们需要使用命令<a href="https://web.archive.org/web/20221002071951/https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noreferrer noopener nofollow">安装AWS CLI </a></p>



<pre class="hljs">curl <span class="hljs-string">"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"</span> -o <span class="hljs-string">"awscliv2.zip"</span>
unzip awscliv2.zip
sudo ./aws/install
</pre>



<p>并使用配置凭据</p>



<pre class="hljs">aws configure
</pre>



<p>在这里，我们需要输入在创建IAM用户步骤中下载的凭证中的访问密钥ID和秘密访问密钥。要测试S3访问，请使用命令</p>



<pre class="hljs">aws s3 ls</pre>



<p>之后，我们需要克隆<a href="https://web.archive.org/web/20221002071951/https://github.com/eneszv/sentiment_analysis_neptune" target="_blank" rel="noreferrer noopener nofollow">项目</a>，安装需求并运行我们的主脚本。可以使用cron作业将脚本部署到生产环境中，方法是设置它将被执行的确切时间，或者如果它是一个正在进行的进程，则使用“nohup”命令。</p>



<p>要设置cron作业，请使用命令</p>



<pre class="hljs">crontab -e</pre>



<p>按“I”进入插入模式并写入</p>



<pre class="hljs">* * * * * cd ~/sentiment_analysis_neptunel/src; ~/venv/bin/python ~/sentiment_analysis_neptune/src/main.py</pre>



<p>其中“* * * * *”是一个cron模式，可以从<a href="https://web.archive.org/web/20221002071951/https://crontab.guru/." target="_blank" rel="noreferrer noopener nofollow">https://crontab.guru/.</a>中定义，路径“~/情操_分析_neptunel/src”是我们需要运行主脚本的地方，“venv/bin/python”是我们使用的python环境。之后，按ESC，然后按:wq，然后按ENTER。要仔细检查创建的cron作业，请使用命令–</p>



<pre class="hljs">crontab -l
</pre>



<p>要使用“nohup”运行python脚本，请使用命令激活您的python环境“venv”</p>



<pre class="hljs">source venv/bin/activate
</pre>



<p>然后跑</p>



<pre class="hljs">nohup python main.py &gt; logs.out &amp;
</pre>



<p>我们的主脚本看起来像</p>



<pre class="hljs"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
	data_sample = get_data()
	run_model(data_sample)
</pre>



<p>其中“get_data”函数准备数据样本，围绕模型和预测的整个逻辑由“run_model”函数完成。现在，如果我们想要影子部署另一个模型，可能只需在主脚本中添加一行代码即可:</p>



<pre class="hljs"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
	data_sample = get_data()
	run_model(data_sample)
	run_shadow_model(data_sample)
</pre>



<p>其中函数“运行影子模型”运行新影子模型的所有逻辑。模型异步运行，首先是生产中的旧模型，然后是新的影子模型。此外，函数“get_data”只被调用一次。如果在“运行”函数中没有外部API调用，这种架构可能会工作得很好，这样我们就不会重复它们。</p>


<div class="wp-block-image">
<figure class="aligncenter size-large"><img data-attachment-id="70747" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=1210%2C497&amp;ssl=1" data-orig-size="1210,497" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=300%2C123&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=1024%2C421&amp;ssl=1" src="../Images/099d6a63c858f73e488132eb1900b928.png" alt="Model of app architecture" class="wp-image-70747 jetpack-lazy-image" data-recalc-dims="1" data-lazy-src="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?resize=1024%2C421&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?resize=1024%2C421&amp;ssl=1"/><noscript><img data-lazy-fallback="1" data-attachment-id="70747" data-permalink="https://web.archive.org/web/20221002071951/https://neptune.ai/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7" data-orig-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=1210%2C497&amp;ssl=1" data-orig-size="1210,497" data-comments-opened="0" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7" data-image-description="" data-image-caption="" data-medium-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=300%2C123&amp;ssl=1" data-large-file="https://web.archive.org/web/20221002071951/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?fit=1024%2C421&amp;ssl=1" src="../Images/099d6a63c858f73e488132eb1900b928.png" alt="Model of app architecture" class="wp-image-70747" data-recalc-dims="1" data-original-src="https://web.archive.org/web/20221002071951im_/https://i0.wp.com/neptune.ai/wp-content/uploads/how-to-make-sure-your-new-model-is-better-than-the-one-in-poduction-7.png?resize=1024%2C421&amp;ssl=1"/></noscript><figcaption><em>App architecture | Source: Author</em></figcaption></figure></div>


<p>在我们确保影子模型顺利运行，没有任何错误和预期的延迟之后，我们需要比较实时和影子结果。这种比较基于我们在开始时提到的一些指标。如果两个模型都有监控系统，可以使用现有的监控系统在线进行比较，也可以离线进行比较，离线时可以对结果或附加日志进行更深入的分析。如果阴影结果更好，我们用阴影模型替换真实模型。</p>



<p>这个项目的全部代码可以在这个库中找到。</p>



<h2>结论</h2>



<p>在本文中，我们讨论了在生产中确保新模型优于旧模型的所有步骤。我们已经描述了从开发到部署的所有阶段，其中我们将新模型与生产中的模型进行比较。这是必要的，因为只在一个阶段比较模型会留下一些错误和问题的可能性。除此之外，我们提到了几个可用于比较的指标。</p>



<p>主要的一点是，仅仅比较开发中的模型是不够的，还必须有一个可靠的部署策略，以确保从业务/用户的角度来看，新模型确实比生产中的模型更好。</p>



<h3>参考</h3>






<div id="author-box-new-format-block_624e9c64b6395" class="article__footer article__author">
  

  <div class="article__authorContent">
          <h3 class="article__authorContent-name">enes zvornianin</h3>
    
          <p class="article__authorContent-text">Enes是一名拥有三年多经验的数据科学家。Enes在数学、计算机科学和机器学习方面有很强的背景，并且热衷于学习和探索与机器学习相关的任何领域。你可以在Linkedin上和他联系。</p>
    
          
    
  </div>
</div>


<div class="wp-container-1 wp-block-group"><div class="wp-block-group__inner-container">
<hr class="wp-block-separator"/>



<p class="has-text-color"><strong>阅读下一篇</strong></p>



<h2>Continuum Industries案例研究:如何跟踪、监控和可视化CI/CD管道</h2>



<p class="has-small-font-size">7分钟阅读| 2021年8月9日更新</p>


<p id="block_5ffc75def9f8e" class="separator separator-10"/>



<p><a href="https://web.archive.org/web/20221002071951/https://www.continuum.industries/" target="_blank" rel="noreferrer noopener nofollow"> Continuum Industries </a>是一家基础设施行业的公司，希望自动化和优化线性基础设施资产的设计，如水管、架空传输线、海底电力线或电信电缆。</p>



<p>其核心产品Optioneer允许客户输入工程设计假设和地理空间数据，并且<strong>使用进化优化算法来寻找可能的解决方案，以在给定约束的情况下连接A点到B点。</strong></p>


<p id="block_610943f455774" class="separator separator-15"/>



<figure class="wp-block-video"><video controls="" src="https://web.archive.org/web/20221002071951im_/https://neptune.ai/wp-content/uploads/Continuum-Industries-video.mp4"/></figure>


<p id="block_617106e0168b3" class="separator separator-15"/>



<p>首席科学家安德烈亚斯·马莱科斯(Andreas Malekos)致力于研究人工智能发动机，他解释道:</p>


<div class="case-study-quote">
    <p>“建造像电力线这样的东西是一个巨大的项目，所以你必须在开始之前获得正确的设计。你看到的设计越合理，你就能做出更好的决定。Optioneer可以在几分钟内为您提供设计资产，而成本只是传统设计方法的一小部分。”</p>
    

</div>



<p>但是，创建和操作Optioneer引擎比看起来更具挑战性:</p>


<div class="custom-point-list">
<ul><li>目标函数不代表现实</li><li>有很多土木工程师事先不知道的假设</li><li>不同的客户给它提出完全不同的问题，算法需要足够健壮来处理这些问题</li></ul>
</div>


<p>与其构建完美的解决方案，不如向他们展示一系列有趣的设计选项，以便他们做出明智的决策。</p>



<p>引擎团队利用来自机械工程、电子工程、计算物理、应用数学和软件工程的各种技能来实现这一目标。</p>



<h2>问题</h2>



<p>无论是否使用人工智能，构建一个成功的软件产品的一个副作用是，人们依赖它工作。当人们依赖您的优化引擎做出价值百万美元的基础设施设计决策时，您需要有一个强大的质量保证(QA)。</p>



<p>正如Andreas所指出的，他们必须能够说，他们返回给用户的解决方案是:</p>


<div class="custom-point-list">
<ul><li><strong>好</strong>，意思是这是一个土木工程师可以看到并同意的结果</li><li><strong>更正</strong>，这意味着计算并返回给最终用户的所有不同工程数量都尽可能准确</li></ul>
</div>


<p>除此之外，该团队还在不断改进优化引擎。但要做到这一点，您必须确保这些变化:</p>


<div class="custom-point-list">
<ul><li>不要以这样或那样的方式破坏算法</li><li>实际上，它们不仅改善了一个基础设施问题的结果，还改善了所有问题的结果</li></ul>
</div>


<p>基本上，您需要<strong>建立适当的验证和测试，</strong>但是团队试图解决的问题的性质带来了额外的挑战:</p>


<div class="custom-point-list">
<ul><li>您无法自动判断算法输出是否正确。<strong>这不像在ML中，你已经标记了数据</strong>来计算你的评估集的准确度或召回率。</li><li>您<strong>需要一组示例问题，代表算法在生产中需要解决的那类问题的</strong>。此外，这些问题需要被版本化，以便尽可能容易地实现可重复性。</li></ul>
</div>

<a class="button continous-post blue-filled" href="/web/20221002071951/https://neptune.ai/customers/continuum-industries" target="_blank">
    Continue reading -&gt;</a>



<hr class="wp-block-separator"/>
</div></div>
</div>
      </div>    
</body>
</html>